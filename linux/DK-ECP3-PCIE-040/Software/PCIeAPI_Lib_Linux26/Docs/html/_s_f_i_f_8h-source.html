<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>Lattice PCIe API Manual: SFIF.h Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.9.1 -->
<div class="qindex"><a class="qindex" href="main.html">Main&nbsp;Page</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a></div>
<div class="nav">
<a class="el" href="dir_000001.html">DevObjs</a></div>
<h1>SFIF.h</h1><a href="_s_f_i_f_8h.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment">00001 <span class="comment">/*</span>
00002 <span class="comment"> *  COPYRIGHT (c) 2008 by Lattice Semiconductor Corporation</span>
00003 <span class="comment"> *</span>
00004 <span class="comment"> * All rights reserved. All use of this software and documentation is</span>
00005 <span class="comment"> * subject to the License Agreement located in the file LICENSE.</span>
00006 <span class="comment"> */</span>
00007 
00010 <span class="preprocessor">#ifndef LATTICE_SEMI_PCIE_SFIF_H</span>
00011 <span class="preprocessor"></span><span class="preprocessor">#define LATTICE_SEMI_PCIE_SFIF_H</span>
00012 <span class="preprocessor"></span>
00013 <span class="preprocessor">#define POSIX_C_SOURCE 199506</span>
00014 <span class="preprocessor"></span>
00015 <span class="preprocessor">#include &lt;unistd.h&gt;</span>
00016 <span class="preprocessor">#include &lt;sys/types.h&gt;</span>
00017 <span class="preprocessor">#include &lt;string&gt;</span>
00018 <span class="preprocessor">#include &lt;time.h&gt;</span>
00019 <span class="preprocessor">#include &lt;exception&gt;</span>
00020 
00021 <span class="preprocessor">#include "dllDef.h"</span>
00022 
00023 <span class="preprocessor">#include "<a class="code" href="_device_8h.html">Device.h</a>"</span>
00024 <span class="preprocessor">#include "<a class="code" href="_register_access_8h.html">RegisterAccess.h</a>"</span>
00025 <span class="preprocessor">#include "<a class="code" href="_l_s_c_p_c_ie2___i_f_8h.html">LSCPCIe2_IF.h</a>"</span>
00026 
00027 <span class="comment">/*</span>
00028 <span class="comment"> * Lattice Semiconductor Corp. namespace.</span>
00029 <span class="comment"> */</span>
00030 <span class="keyword">namespace </span>LatticeSemi_PCIe
00031 {
00032  
00033 <span class="comment">// Run Modes for the SFIF</span>
00034 <span class="preprocessor">#define THRUPUT_MODE    0   </span>
00035 <span class="preprocessor"></span><span class="preprocessor">#define READ_CYC_MODE   1</span>
00036 <span class="preprocessor"></span><span class="preprocessor">#define WRITE_CYC_MODE  2    </span>
00037 <span class="preprocessor"></span>
00038 <span class="preprocessor">#define MRD_TLPS  1    </span>
00039 <span class="preprocessor"></span><span class="preprocessor">#define MWR_TLPS  2    </span>
00040 <span class="preprocessor"></span><span class="preprocessor">#define MRD_MWR_TLPS  3    </span>
00041 <span class="preprocessor"></span><span class="preprocessor">#define MRD_MWR_CTRL_TLPS 4    </span>
00042 <span class="preprocessor"></span>
00043 
00044 <span class="comment">// all PCs we've seen have these same settings</span>
00045 <span class="preprocessor">#define MAX_TLP_SIZE 128   </span>
00046 <span class="preprocessor"></span><span class="preprocessor">#define MAX_READ_SIZE 512</span>
00047 <span class="preprocessor"></span><span class="preprocessor">#define RCB 64</span>
00048 <span class="preprocessor"></span><span class="preprocessor">#define RCB_DW (RCB / 4)</span>
00049 <span class="preprocessor"></span>    
00050 <span class="preprocessor">#define MAX_ADDRESS     0x40   // register address space module takes up</span>
00051 <span class="preprocessor"></span><span class="preprocessor">#define FIFO_SIZE (16 * 1024)   // size of Tx and Rx FIFOs in SFIF</span>
00052 <span class="preprocessor"></span>
00053 <span class="comment">/* Register Definitions */</span>
00054 <span class="preprocessor">#define SFIF_CTRL       0x00 // Global Control - Controls operation of SFIF</span>
00055 <span class="preprocessor"></span><span class="preprocessor">#define SFIF_TXTLP_CTRL 0x04 // Tx TLP Control  - Tx TLP control of loading TLP into FIFO</span>
00056 <span class="preprocessor"></span><span class="preprocessor">#define SFIF_TXICG_CTRL 0x08 // Tx ICG Control - Tx Inter-Cycle TLP Gap control</span>
00057 <span class="preprocessor"></span><span class="preprocessor">#define SFIF_TXTLP_DATA 0x0c // Tx TLP Data - DW of TLP data</span>
00058 <span class="preprocessor"></span><span class="preprocessor">#define SFIF_RXTLP_DATA 0x10 // Rx TLP Data - DW of Completion TLP data</span>
00059 <span class="preprocessor"></span><span class="preprocessor">#define SFIF_ELAPSE_CNT 0x14 // Elapsed Count - Number of clock cycles in current run</span>
00060 <span class="preprocessor"></span><span class="preprocessor">#define SFIF_TXTLP_CNT  0x18 // Tx TLP Count - Number of Tx TLPs sent in current run</span>
00061 <span class="preprocessor"></span><span class="preprocessor">#define SFIF_RXTLP_CNT  0x1c // Rx TLP Count - Number of CplDs received in current run</span>
00062 <span class="preprocessor"></span><span class="preprocessor">#define SFIF_WRWAIT_CNT 0x20 // Wr Wait Time  - Number of clock cycles waiting for Posted Credits in current run</span>
00063 <span class="preprocessor"></span><span class="preprocessor">#define SFIF_LAST_CPLD  0x24 // Last CplD Time - Timestamp for last CplD</span>
00064 <span class="preprocessor"></span><span class="preprocessor">#define SFIF_RDWAIT_CNT 0x28 // Rd Wait Time  - Number of clocks cycles waiting for Non-Posted Credits or Tags in current run</span>
00065 <span class="preprocessor"></span>
00066 
00067 
00068 
00069 
<a name="l00093"></a><a class="code" href="class_lattice_semi___p_c_ie_1_1_s_f_i_f.html">00093</a> <span class="keyword">class </span>DLLIMPORT SFIF : <span class="keyword">public</span> LatticeSemi_PCIe::<a class="code" href="class_lattice_semi___p_c_ie_1_1_device.html">Device</a>
00094 {
00095 <span class="keyword">public</span>:
00096     <span class="keyword">typedef</span> <span class="keyword">struct </span>
00097 <span class="keyword">    </span>{
00098         uint32_t ElapsedTime;
00099         uint32_t TxTLPCnt;
00100         uint32_t RxTLPCnt;
00101         uint32_t WrWaitTime;
00102         uint32_t LastCplDTime;
00103         uint32_t RdWaitTime;
00104     } SFIFCntrs_t;
00105 
00106         
00107     SFIF(<span class="keyword">const</span> <span class="keywordtype">char</span> *nameStr, 
00108          uint32_t addr, 
00109          <a class="code" href="class_lattice_semi___p_c_ie_1_1_register_access.html">LatticeSemi_PCIe::RegisterAccess</a> *pRA); 
00110 
00111     <span class="keyword">virtual</span> ~SFIF();
00112  
00113     <span class="keywordtype">void</span> showRegs(<span class="keywordtype">void</span>);
00114     <span class="keywordtype">bool</span> getSFIFParseRxFIFO(string &amp;outs);
00115     <span class="keywordtype">int</span>  getSFIFRegs(<span class="keywordtype">long</span> <span class="keywordtype">long</span> *elements, <span class="keywordtype">int</span> len);
00116     <span class="keywordtype">void</span>  getCntrs(SFIFCntrs_t &amp;cnts);
00117 
00118     uint32_t  getRxFIFO(uint32_t *pBuf, size_t len = 0);
00119 
00120     <span class="keywordtype">bool</span> cfgTLP(uint32_t rlxOrd,
00121                 uint32_t snoop,
00122                 uint32_t trafficClass,
00123                 uint32_t poisoned);
00124 
00125     <span class="keywordtype">bool</span> setupSFIF(uint32_t runMode, 
00126             uint32_t trafficMode, 
00127             uint32_t cycles, 
00128             uint32_t ICG, 
00129             uint32_t rdTLPSize, 
00130             uint32_t wrTLPSize, 
00131             uint32_t numRdTLPs, 
00132             uint32_t numWrTLPs,
00133             uint32_t pktRdRatio = 4,
00134             uint32_t pktWrRatio = 1);
00135 
00136 
00137     <span class="keywordtype">bool</span> verifyMWrXfer(uint32_t *pUserBuf, size_t len = 0);
00138 
00139     <span class="keywordtype">bool</span> startSFIF(<span class="keywordtype">bool</span> loop);
00140     <span class="keywordtype">bool</span> stopSFIF();
00141     <span class="keywordtype">void</span> disableSFIF();
00142 
00143 
00144 <span class="keyword">private</span>:
00145     <span class="keyword">typedef</span> <span class="keyword">struct </span>_RxBin
00146     {
00147         uint32_t buf[MAX_READ_SIZE/4];
00148         uint32_t index;
00149         uint32_t size;
00150     } RxBin_t;
00151           
00152     <a class="code" href="class_lattice_semi___p_c_ie_1_1_l_s_c_p_c_ie2___i_f.html">LSCPCIe2_IF</a> *pDrvr;
00153     <span class="keywordtype">void</span>    *arg;
00154     <span class="keywordtype">bool</span>    loadMRdTLP(uint32_t numDWs, uint32_t rdAddr, uint32_t tag);
00155     <span class="keywordtype">bool</span>    loadMWrTLP(uint32_t numDWs, uint32_t *payload, uint32_t wrAddr);
00156 
00157     uint32_t DmaPhysAddrLo;
00158     uint32_t DmaCommonBufAddr;
00159     uint32_t DmaCommonBufSize;
00160 
00161     uint32_t RequesterID;
00162     uint32_t ReadReqSize;
00163     uint32_t TotalBytesReq;
00164     <span class="keywordtype">bool</span>     RxFifoValid;
00165     
00166 
00167     uint32_t ReadDmaBuf[FIFO_SIZE/4];
00168     uint32_t WriteDmaBuf[FIFO_SIZE/4];
00169     uint32_t RxFIFO[FIFO_SIZE/4];
00170 
00171     RxBin_t RxCpl[32];
00172 
00173     <span class="keywordtype">bool</span> Aligned4k, Aligned128;
00174 
00175     uint32_t RlxOrdBit;
00176     uint32_t SnoopBit;
00177     uint32_t TrafficClassBits;
00178     uint32_t PoisonedBit;
00179 
00180     uint8_t RunTimes;
00181 
00182     uint32_t TxSaveBuf[FIFO_SIZE/4];
00183     uint32_t *TxSavePtr;
00184     uint32_t TxSaveLen;
00185 };
00186 
<a name="l00194"></a><a class="code" href="class_lattice_semi___p_c_ie_1_1_s_f_i_f___error.html">00194</a> <span class="keyword">class </span><a class="code" href="class_lattice_semi___p_c_ie_1_1_s_f_i_f___error.html">SFIF_Error</a> : <span class="keyword">public</span> exception 
00195 { 
00196    <span class="keyword">public</span>:
00197        <a class="code" href="class_lattice_semi___p_c_ie_1_1_s_f_i_f___error.html">SFIF_Error</a>(<span class="keywordtype">char</span> *s) {msg = s;}
00198        <span class="keyword">virtual</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *what(<span class="keywordtype">void</span>) <span class="keyword">const</span> <span class="keywordflow">throw</span>()
00199        {
00200            <span class="keywordflow">return</span>(msg);
00201        }
00202 
00203    <span class="keyword">private</span>:
00204        <span class="keywordtype">char</span> *msg;
00205 };
00206 
00207 } <span class="comment">//END_NAMESPACE</span>
00208 
00209 <span class="preprocessor">#endif</span>
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Wed Jul 16 12:05:26 2008 for Lattice PCIe API Manual by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.3.9.1 </small></address>
</body>
</html>
