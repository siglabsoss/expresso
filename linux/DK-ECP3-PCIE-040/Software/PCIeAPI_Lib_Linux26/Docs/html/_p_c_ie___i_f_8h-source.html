<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>Lattice PCIe API Manual: PCIe_IF.h Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.9.1 -->
<div class="qindex"><a class="qindex" href="main.html">Main&nbsp;Page</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a></div>
<div class="nav">
<a class="el" href="dir_000006.html">DriverIF</a></div>
<h1>PCIe_IF.h</h1><a href="_p_c_ie___i_f_8h.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment">00001 <span class="comment">/*</span>
00002 <span class="comment"> *  COPYRIGHT (c) 2008 by Lattice Semiconductor Corporation</span>
00003 <span class="comment"> *</span>
00004 <span class="comment"> * All rights reserved. All use of this software and documentation is</span>
00005 <span class="comment"> * subject to the License Agreement located in the file LICENSE.</span>
00006 <span class="comment"> */</span>
00007 
00010 <span class="preprocessor">#ifndef LATTICE_SEMI_PCIE_IF_H</span>
00011 <span class="preprocessor"></span><span class="preprocessor">#define LATTICE_SEMI_PCIE_IF_H</span>
00012 <span class="preprocessor"></span>
00013 
00014 <span class="preprocessor">#include &lt;unistd.h&gt;</span>
00015 <span class="preprocessor">#include &lt;sys/types.h&gt;</span>
00016 
00017 <span class="preprocessor">#include "dllDef.h"</span>
00018 
00019 <span class="preprocessor">#include "<a class="code" href="_register_access_8h.html">RegisterAccess.h</a>"</span>
00020 
00021 <span class="comment">// The driver interface definitions</span>
00022 <span class="preprocessor">#include "<a class="code" href="lscpcie_2_ioctl_8h.html">lscpcie/Ioctl.h</a>"</span>
00023 
00024 
00025 <span class="comment">/*</span>
00026 <span class="comment"> * Lattice Semiconductor Corp. namespace</span>
00027 <span class="comment"> */</span>
00028 <span class="keyword">namespace </span>LatticeSemi_PCIe
00029 {
00030 
00031 
00032 <span class="preprocessor">#ifndef MAX_PCI_BARS</span>
00033 <span class="preprocessor"></span><span class="preprocessor">#define MAX_PCI_BARS 7</span>
00034 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
00035 <span class="preprocessor"></span>
<a name="l00040"></a><a class="code" href="_p_c_ie___i_f_8h.html#a1">00040</a> <span class="preprocessor">#define BAR0(a) (0x00000000 | a)</span>
00041 <span class="preprocessor"></span><span class="preprocessor">#define BAR1(a) (0x10000000 | a)</span>
00042 <span class="preprocessor"></span><span class="preprocessor">#define BAR2(a) (0x20000000 | a)</span>
00043 <span class="preprocessor"></span><span class="preprocessor">#define BAR3(a) (0x30000000 | a)</span>
00044 <span class="preprocessor"></span><span class="preprocessor">#define BAR4(a) (0x40000000 | a)</span>
00045 <span class="preprocessor"></span><span class="preprocessor">#define BAR5(a) (0x50000000 | a)</span>
00046 <span class="preprocessor"></span><span class="preprocessor">#define BAREXP(a) (0x60000000 | a)</span>
00047 <span class="preprocessor"></span>
00048 
00049 
00050 <span class="preprocessor">#define OFFSET2BAR(o) (o&gt;&gt;28)</span>
00051 <span class="preprocessor"></span><span class="preprocessor">#define OFFSET2ADDR(o) (o &amp; 0x0fffffff)</span>
00052 <span class="preprocessor"></span><span class="preprocessor">#define WB(a) (a &amp; 0x0fffffff)</span>
00053 <span class="preprocessor"></span>
00054 <span class="preprocessor">#define BARADDR2BAR(o) (o&gt;&gt;28)</span>
00055 <span class="preprocessor"></span><span class="preprocessor">#define BARADDR2OFFSET(o) (o &amp; 0x0fffffff)</span>
00056 <span class="preprocessor"></span><span class="preprocessor">#define MAKE_BARADDR(n, o) ((n&lt;&lt;28) | (o &amp; 0x0fffffff))</span>
00057 <span class="preprocessor"></span>
00058 <span class="preprocessor">#define MAX_DEV_FILENAME_SIZE 1024   // maximum chars in a device driver filename</span>
00059 <span class="preprocessor"></span><span class="preprocessor">#define MAX_FUNCTION_NAME_SIZE 64   // maximum chars in a driver function string</span>
00060 <span class="preprocessor"></span>
00061 <span class="comment">// TODO - Remove these Windows based defines</span>
00062 <span class="preprocessor">#define MAX_DEV_VEND_STR 18     // example fomat is: "ven_1204&amp;dev_5303"</span>
00063 <span class="preprocessor"></span><span class="preprocessor">#define MAX_SUBSYS_STR 16 // exmaple format is: "subsys_30301204"</span>
00064 <span class="preprocessor"></span><span class="preprocessor">#define MAX_DEV_ID_STR  (MAX_DEV_VEND_STR + MAX_SUBSYS_STR + 4)</span>
00065 <span class="preprocessor"></span>
00066 
00067 <span class="preprocessor">#define MAX_BOARD_ID_SIZE 32</span>
00068 <span class="preprocessor"></span><span class="preprocessor">#define MAX_DEMO_ID_SIZE 32</span>
00069 <span class="preprocessor"></span>
00070 
00071 <span class="comment">/* Define all driver/Board types */</span>
00072 <span class="preprocessor">#define LSCPCIE_SC   0x53031204                    // PCI Device ID for the SC board</span>
00073 <span class="preprocessor"></span><span class="preprocessor">#define LSCPCIE_EC   0xe2351204                    // PCI Device ID for the ECP2M board</span>
00074 <span class="preprocessor"></span>
00075 <span class="preprocessor">#define MAX_RW_BLOCK_SIZE 4096   // Maximum number of bytes per block transfer operation</span>
00076 <span class="preprocessor"></span>
00077 <span class="keyword">typedef</span> <span class="keyword">struct</span>
00078 <span class="keyword"></span>{
00079     uint16_t vendorID;   <span class="comment">// 00</span>
00080     uint16_t deviceID;   <span class="comment">// 02</span>
00081     uint16_t command;    <span class="comment">// 04</span>
00082     uint16_t status;     <span class="comment">// 06</span>
00083     uint8_t  revID;      <span class="comment">// 08</span>
00084     uint8_t  classCode[3];      <span class="comment">// 09</span>
00085     uint8_t  cacheLineSize;      <span class="comment">// 0c</span>
00086     uint8_t  latencyTimer;      <span class="comment">// 0d</span>
00087     uint8_t  headerType;      <span class="comment">// 0e</span>
00088     uint8_t  BIST;      <span class="comment">// 0f</span>
00089     uint32_t BAR0;      <span class="comment">// 10</span>
00090     uint32_t BAR1;      <span class="comment">// 14</span>
00091     uint32_t BAR2;      <span class="comment">// 18</span>
00092     uint32_t BAR3;      <span class="comment">// 1c</span>
00093     uint32_t BAR4;      <span class="comment">// 20</span>
00094     uint32_t BAR5;      <span class="comment">// 24</span>
00095     uint32_t cardBusPtr;      <span class="comment">// 28</span>
00096     uint16_t subsystemVendorID;   <span class="comment">// 2c </span>
00097     uint16_t subsystemID;         <span class="comment">// 2e</span>
00098     uint32_t expROM_BAR;      <span class="comment">// 30</span>
00099     uint8_t  capabilitiesPtr;      <span class="comment">// 34</span>
00100     uint8_t  reserved[7];
00101     uint8_t  interruptLine;      <span class="comment">// 3c</span>
00102     uint8_t  interruptPin;      <span class="comment">// 3d</span>
00103     uint8_t  minGrant;      <span class="comment">// 3e</span>
00104     uint8_t  maxLatency;      <span class="comment">// 3f</span>
00105 } PCICfgRegs_t;
00106 
<a name="l00157"></a><a class="code" href="class_lattice_semi___p_c_ie_1_1_p_c_ie___i_f.html">00157</a> <span class="keyword">class </span>DLLIMPORT PCIe_IF : <span class="keyword">public</span> LatticeSemi_PCIe::<a class="code" href="class_lattice_semi___p_c_ie_1_1_register_access.html">RegisterAccess</a>
00158 {
00159 <span class="keyword">public</span>:
00160 
00161     <span class="comment">// Board Identifiers  (PCI DEV_VEND pair)</span>
00162     <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *PCIE_SC_BRD;      <span class="comment">// @deprecated Generic SC board ID used in older demo designs</span>
00163     <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *PCIE_ECP2M_BRD;      <span class="comment">// @deprecated Generic ECP2M board ID used in older demo designs</span>
00164     <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *PCIE_ECP2M35_BRD;      <span class="comment">// @deprecated Generic ECP2M board ID used in older demo designs</span>
00165     <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *PCIE_ECP2M50_BRD;      <span class="comment">// @deprecated Generic ECP2M board ID used in older demo designs</span>
00166 
00167     <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *SC80_PCIE_x8_BRD_GL028;    <span class="comment">// SC80, 1152 pkg, x8, SMPTE BNC connectors, 16 SegLED</span>
00168     <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *ECP2M35_PCIE_x4_BRD_GL029; <span class="comment">// ECP2M35, 672 pkg, SMPTE BNC, 16 SegLED</span>
00169     <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *ECP2M50_PCIE_x4_BRD_GL029; <span class="comment">// ECP2M50, 672 pkg, SMPTE BNC, 16 SegLED</span>
00170     <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *SC25_PCIE_x1_BRD_GL030;    <span class="comment">// SC25, 900 pkg, x1 connector, RJ45+SFP+SATA, no 16 Seg</span>
00171     <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *ECP2M35_PCIE_x1_BRD_GL031; <span class="comment">// ECP2M35, 672 pkg, x1 connector, SFP+SATA</span>
00172     <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *ECP2M35_PCIE_x1_BRD_GL034; <span class="comment">// ECP2M35 video board, x1 connector, doudle height</span>
00173     <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *SC80_PCIE_x4_BRD_GL035;    <span class="comment">// SC80(v3), 1152 pkg, x4 connector,  16 SegLED</span>
00174 
00175     <span class="comment">// Demo Identifiers  (PCI SUBSYS pair)</span>
00176     <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *PCIE_DEMO_SC;    <span class="comment">// original PCIe control plane demo for SC80 &amp; 25 boards</span>
00177     <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *PCIE_DEMO_EC;    <span class="comment">//  original PCIe control plane demo for ECP2M35 boards</span>
00178     <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *BASIC_DEMO;      <span class="comment">//  original PCIe Basic demo for all boards</span>
00179     <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *SFIF_DEMO;       <span class="comment">// PCIeThruput demo ID</span>
00180     <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *PCIEDMA_DEMO;    <span class="comment">// PCIe SGDMA demo ID - SGDMA to/from user space memory</span>
00181     
00182     <span class="keyword">static</span> <span class="keyword">const</span> GUID *pLSCSIM_DRIVER;
00183     <span class="keyword">static</span> <span class="keyword">const</span> GUID *pLSCPCIE_DRIVER;
00184     <span class="keyword">static</span> <span class="keyword">const</span> GUID *pLSCPCIE2_DRIVER;
00185     <span class="keyword">static</span> <span class="keyword">const</span> GUID *pLSCDMA_DRIVER;
00186 
00187 
00188     
00189     PCIe_IF(<span class="keyword">const</span> GUID *pGUID, 
00190             <span class="keyword">const</span> <span class="keywordtype">char</span> *pBoardID,
00191             <span class="keyword">const</span> <span class="keywordtype">char</span> *pDemoID,
00192             uint32_t devNum = 1, 
00193             <span class="keyword">const</span> <span class="keywordtype">char</span> *pFriendlyName = NULL, 
00194             <span class="keyword">const</span> <span class="keywordtype">char</span> *pFunctionName = NULL);
00195 
00196     ~PCIe_IF();
00197 
00198     HANDLE getDriverHandle(<span class="keywordtype">void</span>);
00199 
00200     <span class="keywordtype">bool</span> getPCIConfigRegs(uint8_t *pCfg);
00201     <span class="keywordtype">bool</span> getPCIDriverInfo(<span class="keyword">const</span> <a class="code" href="struct_p_c_i_resource_info__t.html">PCIResourceInfo_t</a> **pInfo);
00202 
00203     <span class="keywordtype">bool</span> getPCIResourcesStr(string &amp;outs);
00204     <span class="keywordtype">bool</span> getDriverVersionStr(string &amp;outs);
00205     <span class="keywordtype">bool</span> getDriverResourcesStr(string &amp;outs);
00206     <span class="keywordtype">bool</span> getPCICapabiltiesStr(string &amp;outs);
00207 
00208     uint8_t read8(uint32_t addr);
00209     <span class="keywordtype">void</span> write8(uint32_t addr, uint8_t val);
00210     uint16_t read16(uint32_t addr);
00211     <span class="keywordtype">void</span> write16(uint32_t addr, uint16_t val);
00212     uint32_t read32(uint32_t addr);
00213     <span class="keywordtype">void</span> write32(uint32_t addr, uint32_t val);
00214 
00215     <span class="comment">/* Block Access Methods */</span>
00216     <span class="keywordtype">bool</span> read8(uint32_t addr, uint8_t *val, size_t len, <span class="keywordtype">bool</span> incAddr=<span class="keyword">true</span>);
00217     <span class="keywordtype">bool</span> write8(uint32_t addr, uint8_t *val, size_t len, <span class="keywordtype">bool</span> incAddr=<span class="keyword">true</span>);
00218     <span class="keywordtype">bool</span> read16(uint32_t addr, uint16_t *val, size_t len, <span class="keywordtype">bool</span> incAddr=<span class="keyword">true</span>);
00219     <span class="keywordtype">bool</span> write16(uint32_t addr, uint16_t *val, size_t len, <span class="keywordtype">bool</span> incAddr=<span class="keyword">true</span>);
00220     <span class="keywordtype">bool</span> read32(uint32_t addr, uint32_t *val, size_t len, <span class="keywordtype">bool</span> incAddr=<span class="keyword">true</span>);
00221     <span class="keywordtype">bool</span> write32(uint32_t addr, uint32_t *val, size_t len, <span class="keywordtype">bool</span> incAddr=<span class="keyword">true</span>);
00222 
00223 <span class="keyword">protected</span>:
00224     HANDLE  hDev;
00225     <span class="keywordtype">int</span> OpenDriver(HANDLE &amp;h,
00226             <span class="keyword">const</span> GUID *pGUID, 
00227             <span class="keyword">const</span> <span class="keywordtype">char</span> *pBoardID,
00228             <span class="keyword">const</span> <span class="keywordtype">char</span> *pDemoID,
00229             uint32_t instance = 1, 
00230             <span class="keyword">const</span> <span class="keywordtype">char</span> *pFriendlyName = NULL, 
00231             <span class="keyword">const</span> <span class="keywordtype">char</span> *pFunctionName = NULL);
00232 
00233     <span class="keywordtype">int</span> MmapDriver(<span class="keywordtype">void</span>);
00234 
00235     <a class="code" href="struct_p_c_i_resource_info__t.html">PCIResourceInfo_t</a> PCIinfo;
00236 
<a name="l00237"></a><a class="code" href="class_lattice_semi___p_c_ie_1_1_p_c_ie___i_f.html#p2">00237</a>     <span class="keyword">volatile</span> <span class="keywordtype">void</span> *pBAR[MAX_PCI_BARS];   
<a name="l00238"></a><a class="code" href="class_lattice_semi___p_c_ie_1_1_p_c_ie___i_f.html#p3">00238</a>     size_t         sizeBAR[MAX_PCI_BARS]; 
00240 <span class="keyword">private</span>:
00241 
00242 };
00243 
<a name="l00251"></a><a class="code" href="class_lattice_semi___p_c_ie_1_1_p_c_ie___i_f___error.html">00251</a> <span class="keyword">class </span>DLLIMPORT PCIe_IF_Error : <span class="keyword">public</span> exception 
00252 { 
00253    <span class="keyword">public</span>:
00254        PCIe_IF_Error(<span class="keywordtype">char</span> *s) {msg = s;}
00255        <span class="keyword">virtual</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *what(<span class="keywordtype">void</span>) <span class="keyword">const</span> <span class="keywordflow">throw</span>()
00256        {
00257            <span class="keywordflow">return</span>(msg);
00258        }
00259 
00260    <span class="keyword">private</span>:
00261        <span class="keywordtype">char</span> *msg;
00262 };
00263 
00264 } <span class="comment">//END_NAMESPACE</span>
00265 
00266 <span class="preprocessor">#endif</span>
00267 <span class="preprocessor"></span>
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Wed Jul 16 12:05:26 2008 for Lattice PCIe API Manual by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.3.9.1 </small></address>
</body>
</html>
