<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>Lattice PCIe API Manual: Mem.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.9.1 -->
<div class="qindex"><a class="qindex" href="main.html">Main&nbsp;Page</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a></div>
<div class="nav">
<a class="el" href="dir_000001.html">DevObjs</a></div>
<h1>Mem.cpp</h1><a href="_mem_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment">00001 <span class="comment">/*</span>
00002 <span class="comment"> *  COPYRIGHT (c) 2008 by Lattice Semiconductor Corporation</span>
00003 <span class="comment"> *</span>
00004 <span class="comment"> * All rights reserved. All use of this software and documentation is</span>
00005 <span class="comment"> * subject to the License Agreement located in the file LICENSE.</span>
00006 <span class="comment"> */</span>
00007 
00010 <span class="preprocessor">#include &lt;cstdlib&gt;</span>
00011 <span class="preprocessor">#include &lt;iostream&gt;</span>
00012 <span class="preprocessor">#include &lt;string&gt;</span>
00013 <span class="preprocessor">#include &lt;sstream&gt;</span>
00014 <span class="preprocessor">#include &lt;iomanip&gt;</span>
00015 
00016 <span class="keyword">using</span> <span class="keyword">namespace </span>std;
00017 
00018 <span class="preprocessor">#include "<a class="code" href="_p_c_ie_a_p_i_8h.html">PCIeAPI.h</a>"</span>
00019 <span class="preprocessor">#include "<a class="code" href="_debug_print_8h.html">DebugPrint.h</a>"</span>
00020 <span class="preprocessor">#include "<a class="code" href="_mem_8h.html">Mem.h</a>"</span>
00021 
00022 <span class="keyword">using</span> <span class="keyword">namespace </span>LatticeSemi_PCIe;
00023 
<a name="l00044"></a><a class="code" href="class_lattice_semi___p_c_ie_1_1_mem.html#a0">00044</a> <a class="code" href="class_lattice_semi___p_c_ie_1_1_mem.html#a0">Mem::Mem</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *nameStr, size_t size, uint32_t baseAddr, <a class="code" href="class_lattice_semi___p_c_ie_1_1_register_access.html">RegisterAccess</a> *pRA) :
00045 <a class="code" href="class_lattice_semi___p_c_ie_1_1_device.html">Device</a>(pRA, nameStr, baseAddr, size)
00046 {
00047     <span class="comment">/* Base Class Device has setup the name, address already */</span>
00048 
00049     this-&gt;len = size;  
00050     this-&gt;accessWidth = 32;  <span class="comment">// default, change via call if not supported</span>
00051 
00052 }
00053 
00054 
<a name="l00062"></a><a class="code" href="class_lattice_semi___p_c_ie_1_1_mem.html#a1">00062</a> <a class="code" href="class_lattice_semi___p_c_ie_1_1_mem.html#a1">Mem::~Mem</a>()
00063 {
00064 
00065 }
00066 
00067 
<a name="l00072"></a><a class="code" href="class_lattice_semi___p_c_ie_1_1_mem.html#a10">00072</a> size_t <a class="code" href="class_lattice_semi___p_c_ie_1_1_mem.html#a10">Mem::getLen</a>(<span class="keywordtype">void</span>) 
00073 { 
00074     <span class="keywordflow">return</span>(len); 
00075 }
00076 
<a name="l00083"></a><a class="code" href="class_lattice_semi___p_c_ie_1_1_mem.html#a11">00083</a> <span class="keywordtype">void</span> <a class="code" href="class_lattice_semi___p_c_ie_1_1_mem.html#a11">Mem::setAccessWidth</a>(uint8_t size)
00084 {
00085     accessWidth = size;
00086 }
00087 
<a name="l00095"></a><a class="code" href="class_lattice_semi___p_c_ie_1_1_mem.html#a2">00095</a> <span class="keywordtype">bool</span> <a class="code" href="class_lattice_semi___p_c_ie_1_1_mem.html#a2">Mem::clear</a>(<span class="keywordtype">void</span>)
00096 {
00097     <span class="comment">// Allocate buffer for memory clearing</span>
00098     uint8_t *wrBuf = <span class="keyword">new</span> uint8_t[this-&gt;len];
00099 
00100     memset(wrBuf, 0, this-&gt;len);
00101     this-&gt;<a class="code" href="class_lattice_semi___p_c_ie_1_1_mem.html#a9">set</a>(0, this-&gt;len, wrBuf);
00102 
00103     <span class="keyword">delete</span> wrBuf;
00104 
00105     <span class="keywordflow">return</span>(<span class="keyword">true</span>);
00106 }
00107 
<a name="l00117"></a><a class="code" href="class_lattice_semi___p_c_ie_1_1_mem.html#a6">00117</a> <span class="keywordtype">bool</span> <a class="code" href="class_lattice_semi___p_c_ie_1_1_mem.html#a6">Mem::fill</a>(uint8_t val)
00118 {
00119     <span class="comment">// Allocate buffer for memory clearing</span>
00120     uint8_t *wrBuf = <span class="keyword">new</span> uint8_t[this-&gt;len];
00121 
00122     memset(wrBuf, (<span class="keywordtype">int</span>)val, this-&gt;len);
00123     this-&gt;<a class="code" href="class_lattice_semi___p_c_ie_1_1_mem.html#a9">set</a>(0, this-&gt;len, wrBuf);
00124 
00125     <span class="keyword">delete</span> wrBuf;
00126 
00127     <span class="keywordflow">return</span>(<span class="keyword">true</span>);
00128 }
00129 
00130 
<a name="l00143"></a><a class="code" href="class_lattice_semi___p_c_ie_1_1_mem.html#a7">00143</a> <span class="keywordtype">bool</span> <a class="code" href="class_lattice_semi___p_c_ie_1_1_mem.html#a6">Mem::fill</a>(uint8_t val, uint32_t offset, size_t flen)
00144 {
00145     <span class="keywordflow">if</span> (flen + offset &gt; this-&gt;len)
00146         <span class="keywordflow">return</span>(<span class="keyword">false</span>);
00147 
00148     <span class="comment">// Allocate buffer for memory clearing</span>
00149     uint8_t *wrBuf = <span class="keyword">new</span> uint8_t[flen];
00150 
00151     memset(wrBuf, (<span class="keywordtype">int</span>)val, flen);
00152     this-&gt;<a class="code" href="class_lattice_semi___p_c_ie_1_1_mem.html#a9">set</a>(offset, flen, wrBuf);
00153 
00154     <span class="keyword">delete</span> wrBuf;
00155 
00156     <span class="keywordflow">return</span>(<span class="keyword">true</span>);
00157 }
00158 
00159 
00160 
<a name="l00166"></a><a class="code" href="class_lattice_semi___p_c_ie_1_1_mem.html#a5">00166</a> <span class="keywordtype">bool</span> <a class="code" href="class_lattice_semi___p_c_ie_1_1_mem.html#a5">Mem::test</a>(size_t len)
00167 {
00168     size_t i;
00169     <span class="keywordtype">int</span> errs;
00170     <span class="keywordtype">bool</span> verbose = RUNTIMECTRL(VERBOSE);
00171 
00172     <span class="keywordflow">if</span> (len == 0)
00173         len = this-&gt;len;  <span class="comment">// default to entire memory device size</span>
00174 
00175     <span class="keywordtype">bool</span> done = <span class="keyword">false</span>;
00176 
00177     <span class="comment">// Allocate buffer for memory testing</span>
00178     uint8_t *wrBuf = <span class="keyword">new</span> uint8_t[len];
00179     uint8_t *rdBuf = <span class="keyword">new</span> uint8_t[len];
00180 
00181     <span class="keywordflow">if</span> (verbose)
00182         cout&lt;&lt;<span class="stringliteral">"=== Memory Test ===\n"</span>;
00183 
00184     <span class="keywordflow">while</span> (!done)
00185     {
00186         errs = 0;
00187         <span class="keywordflow">if</span> (verbose)
00188             cout&lt;&lt;<span class="stringliteral">"Writing all 00's..."</span>;
00189         memset(wrBuf, 0, len);
00190         this-&gt;<a class="code" href="class_lattice_semi___p_c_ie_1_1_mem.html#a9">set</a>(0, len, wrBuf);
00191         <span class="keywordflow">if</span> (verbose)
00192             cout&lt;&lt;<span class="stringliteral">"Verifying..."</span>;
00193         this-&gt;<a class="code" href="class_lattice_semi___p_c_ie_1_1_mem.html#a8">get</a>(0, len, rdBuf);
00194         <span class="keywordflow">for</span> (i = 0; i &lt; len; i++)
00195         {
00196             <span class="keywordflow">if</span> (wrBuf[i] != rdBuf[i])
00197                 ++errs;
00198         }
00199         <span class="keywordflow">if</span> (verbose)
00200         {
00201             <span class="keywordflow">if</span> (errs == 0)
00202                 cout&lt;&lt;<span class="stringliteral">"PASS"</span>&lt;&lt;endl;
00203             <span class="keywordflow">else</span>
00204                 cout&lt;&lt;dec&lt;&lt;errs&lt;&lt;<span class="stringliteral">" ERRORS!!!"</span>&lt;&lt;endl;
00205         }
00206         <span class="keywordflow">if</span> (errs)
00207             <span class="keywordflow">break</span>;  <span class="comment">// abort</span>
00208 
00209         <span class="keywordflow">if</span> (verbose)
00210             cout&lt;&lt;<span class="stringliteral">"Writing all FF's..."</span>;
00211         memset(wrBuf, 0xff, len);
00212         this-&gt;<a class="code" href="class_lattice_semi___p_c_ie_1_1_mem.html#a9">set</a>(0, len, wrBuf);
00213         <span class="keywordflow">if</span> (verbose)
00214             cout&lt;&lt;<span class="stringliteral">"Verifying..."</span>;
00215         this-&gt;<a class="code" href="class_lattice_semi___p_c_ie_1_1_mem.html#a8">get</a>(0, len, rdBuf);
00216         <span class="keywordflow">for</span> (i = 0; i &lt; len; i++)
00217         {
00218             <span class="keywordflow">if</span> (wrBuf[i] != rdBuf[i])
00219                 ++errs;
00220         }
00221         <span class="keywordflow">if</span> (verbose)
00222         {
00223             <span class="keywordflow">if</span> (errs == 0)
00224                 cout&lt;&lt;<span class="stringliteral">"PASS"</span>&lt;&lt;endl;
00225             <span class="keywordflow">else</span>
00226                 cout&lt;&lt;dec&lt;&lt;errs&lt;&lt;<span class="stringliteral">" ERRORS!!!"</span>&lt;&lt;endl;
00227         }
00228         <span class="keywordflow">if</span> (errs)
00229             <span class="keywordflow">break</span>;  <span class="comment">// abort</span>
00230 
00231         <span class="keywordflow">if</span> (verbose)
00232             cout&lt;&lt;<span class="stringliteral">"Writing all AA's..."</span>;
00233         memset(wrBuf, 0xaa, len);
00234         this-&gt;<a class="code" href="class_lattice_semi___p_c_ie_1_1_mem.html#a9">set</a>(0, len, wrBuf);
00235         <span class="keywordflow">if</span> (verbose)
00236             cout&lt;&lt;<span class="stringliteral">"Verifying..."</span>;
00237         this-&gt;<a class="code" href="class_lattice_semi___p_c_ie_1_1_mem.html#a8">get</a>(0, len, rdBuf);
00238         <span class="keywordflow">for</span> (i = 0; i &lt; len; i++)
00239         {
00240             <span class="keywordflow">if</span> (wrBuf[i] != rdBuf[i])
00241                 ++errs;
00242         }
00243         <span class="keywordflow">if</span> (verbose)
00244         {
00245             <span class="keywordflow">if</span> (errs == 0)
00246                 cout&lt;&lt;<span class="stringliteral">"PASS"</span>&lt;&lt;endl;
00247             <span class="keywordflow">else</span>
00248                 cout&lt;&lt;dec&lt;&lt;errs&lt;&lt;<span class="stringliteral">" ERRORS!!!"</span>&lt;&lt;endl;
00249         }
00250         <span class="keywordflow">if</span> (errs)
00251             <span class="keywordflow">break</span>;  <span class="comment">// abort</span>
00252 
00253         <span class="keywordflow">if</span> (verbose)
00254             cout&lt;&lt;<span class="stringliteral">"Writing all 55's..."</span>;
00255         memset(wrBuf, 0x55, len);
00256         this-&gt;<a class="code" href="class_lattice_semi___p_c_ie_1_1_mem.html#a9">set</a>(0, len, wrBuf);
00257         <span class="keywordflow">if</span> (verbose)
00258             cout&lt;&lt;<span class="stringliteral">"Verifying..."</span>;
00259         this-&gt;<a class="code" href="class_lattice_semi___p_c_ie_1_1_mem.html#a8">get</a>(0, len, rdBuf);
00260         <span class="keywordflow">for</span> (i = 0; i &lt; len; i++)
00261         {
00262             <span class="keywordflow">if</span> (wrBuf[i] != rdBuf[i])
00263                 ++errs;
00264         }
00265         <span class="keywordflow">if</span> (verbose)
00266         {
00267             <span class="keywordflow">if</span> (errs == 0)
00268                 cout&lt;&lt;<span class="stringliteral">"PASS"</span>&lt;&lt;endl;
00269             <span class="keywordflow">else</span>
00270                 cout&lt;&lt;dec&lt;&lt;errs&lt;&lt;<span class="stringliteral">" ERRORS!!!"</span>&lt;&lt;endl;
00271         }
00272         <span class="keywordflow">if</span> (errs)
00273             <span class="keywordflow">break</span>;  <span class="comment">// abort</span>
00274 
00275 
00276         <span class="keywordflow">if</span> (verbose)
00277             cout&lt;&lt;<span class="stringliteral">"Writing random pattern..."</span>;
00278         errs = 0;
00279         <span class="keywordflow">for</span> (i = 0; i &lt; len; i++)
00280             wrBuf[i] = (uint8_t)rand();
00281         this-&gt;<a class="code" href="class_lattice_semi___p_c_ie_1_1_mem.html#a9">set</a>(0, len, wrBuf);
00282         <span class="keywordflow">if</span> (verbose)
00283             cout&lt;&lt;<span class="stringliteral">"Verifying..."</span>;
00284         this-&gt;<a class="code" href="class_lattice_semi___p_c_ie_1_1_mem.html#a8">get</a>(0, len, rdBuf);
00285         <span class="keywordflow">for</span> (i = 0; i &lt; len; i++)
00286         {
00287             <span class="keywordflow">if</span> (wrBuf[i] != rdBuf[i])
00288                 ++errs;
00289         }
00290 
00291         <span class="keywordflow">if</span> (verbose)
00292         {
00293             <span class="keywordflow">if</span> (errs == 0)
00294                 cout&lt;&lt;<span class="stringliteral">"PASS"</span>&lt;&lt;endl;
00295             <span class="keywordflow">else</span>
00296                 cout&lt;&lt;dec&lt;&lt;errs&lt;&lt;<span class="stringliteral">" ERRORS!!!"</span>&lt;&lt;endl;
00297         }
00298         <span class="keywordflow">if</span> (errs)
00299             <span class="keywordflow">break</span>;  <span class="comment">// abort</span>
00300 
00301 
00302         <span class="keywordflow">if</span> (verbose)
00303             cout&lt;&lt;<span class="stringliteral">"Writing increment pattern..."</span>;
00304         errs = 0;
00305         <span class="keywordflow">for</span> (i = 0; i &lt; len; i++)
00306             wrBuf[i] = (uint8_t)i;
00307         this-&gt;<a class="code" href="class_lattice_semi___p_c_ie_1_1_mem.html#a9">set</a>(0, len, wrBuf);
00308         <span class="keywordflow">if</span> (verbose)
00309             cout&lt;&lt;<span class="stringliteral">"Verifying..."</span>;
00310         this-&gt;<a class="code" href="class_lattice_semi___p_c_ie_1_1_mem.html#a8">get</a>(0, len, rdBuf);
00311         <span class="keywordflow">for</span> (i = 0; i &lt; len; i++)
00312         {
00313             <span class="keywordflow">if</span> (wrBuf[i] != rdBuf[i])
00314                 ++errs;
00315         }
00316 
00317         <span class="keywordflow">if</span> (verbose)
00318         {
00319             <span class="keywordflow">if</span> (errs == 0)
00320                 cout&lt;&lt;<span class="stringliteral">"PASS"</span>&lt;&lt;endl;
00321             <span class="keywordflow">else</span>
00322                 cout&lt;&lt;dec&lt;&lt;errs&lt;&lt;<span class="stringliteral">" ERRORS!!!"</span>&lt;&lt;endl;
00323         }
00324         <span class="keywordflow">if</span> (errs)
00325             <span class="keywordflow">break</span>;  <span class="comment">// abort</span>
00326 
00327         done = <span class="keyword">true</span>;
00328     }
00329 
00330     <span class="keyword">delete</span> wrBuf;
00331     <span class="keyword">delete</span> rdBuf;
00332 
00333     <span class="keywordflow">if</span> (errs)
00334         <span class="keywordflow">return</span>(<span class="keyword">false</span>);
00335     <span class="keywordflow">else</span>
00336         <span class="keywordflow">return</span>(<span class="keyword">true</span>);
00337 }
00338 
00339 
00340 
00341 
00342 
<a name="l00352"></a><a class="code" href="class_lattice_semi___p_c_ie_1_1_mem.html#a3">00352</a> <span class="keywordtype">bool</span> <a class="code" href="class_lattice_semi___p_c_ie_1_1_mem.html#a3">Mem::loadFromFile</a>(<span class="keywordtype">char</span> *fName)
00353 {
00354     size_t flen;
00355     FILE *fp;
00356     <span class="keywordtype">bool</span> verbose = RUNTIMECTRL(VERBOSE);
00357 
00358     <span class="comment">// Allocate buffer for memory clearing</span>
00359     uint8_t *wrBuf = <span class="keyword">new</span> uint8_t[this-&gt;len];
00360 
00361     <span class="keywordflow">if</span> (verbose)
00362         cout&lt;&lt;<span class="stringliteral">"===  File--&gt;EBR  ===\n"</span>;
00363     fp = fopen(fName, <span class="stringliteral">"rb"</span>);
00364     <span class="keywordflow">if</span> (fp == NULL)
00365     {
00366         <span class="keywordflow">if</span> (verbose)
00367             cout&lt;&lt;<span class="stringliteral">"ERROR! Can't open file: "</span>&lt;&lt;fName&lt;&lt;endl;
00368         <span class="keyword">delete</span> wrBuf;
00369         <span class="keywordflow">return</span>(<span class="keyword">false</span>);
00370     }
00371     flen = fread(wrBuf, 1, this-&gt;len, fp);  <span class="comment">// load data into write buffer</span>
00372     <span class="keywordflow">if</span> ((flen == 0) || (flen == (size_t)EOF))
00373     {
00374         fclose(fp);
00375         <span class="keywordflow">if</span> (verbose)
00376             cout&lt;&lt;<span class="stringliteral">"ERROR! Reading file: "</span>&lt;&lt;fName&lt;&lt;endl;
00377         <span class="keyword">delete</span> wrBuf;
00378         <span class="keywordflow">return</span>(<span class="keyword">false</span>);
00379     }
00380     this-&gt;<a class="code" href="class_lattice_semi___p_c_ie_1_1_mem.html#a9">set</a>(0, flen, wrBuf);    <span class="comment">// store file data into EBR</span>
00381     <span class="keywordflow">if</span> (verbose)
00382         cout&lt;&lt;fName&lt;&lt;<span class="stringliteral">": "</span>&lt;&lt;dec&lt;&lt;flen&lt;&lt;<span class="stringliteral">" bytes loaded into EBR."</span>&lt;&lt;endl;
00383     fclose(fp);
00384 
00385     <span class="keyword">delete</span> wrBuf;
00386     <span class="keywordflow">return</span>(<span class="keyword">true</span>);
00387 }
00388 
00389 
00390 
<a name="l00397"></a><a class="code" href="class_lattice_semi___p_c_ie_1_1_mem.html#a4">00397</a> <span class="keywordtype">bool</span> <a class="code" href="class_lattice_semi___p_c_ie_1_1_mem.html#a4">Mem::saveToFile</a>(<span class="keywordtype">char</span> *fName)
00398 {
00399     size_t n;
00400     FILE *fp;
00401     <span class="keywordtype">bool</span> ret = <span class="keyword">true</span>;
00402     <span class="keywordtype">bool</span> verbose = RUNTIMECTRL(VERBOSE);
00403 
00404     <span class="comment">// Allocate buffer for memory clearing</span>
00405     uint8_t *rdBuf = <span class="keyword">new</span> uint8_t[this-&gt;len];
00406 
00407     <span class="keywordflow">if</span> (verbose)
00408         cout&lt;&lt;<span class="stringliteral">"===  EBR--&gt;File  ===\n"</span>;
00409     fp = fopen(fName, <span class="stringliteral">"wb"</span>);
00410     <span class="keywordflow">if</span> (fp == NULL)
00411     {
00412         <span class="keywordflow">if</span> (verbose)
00413             cout&lt;&lt;<span class="stringliteral">"ERROR! Can't open file: "</span>&lt;&lt;fName&lt;&lt;endl;
00414         <span class="keywordflow">return</span>(<span class="keyword">false</span>);
00415     }
00416 
00417     this-&gt;<a class="code" href="class_lattice_semi___p_c_ie_1_1_mem.html#a8">get</a>(0, this-&gt;len, rdBuf);    <span class="comment">// get what is in EBR memory</span>
00418     n = fwrite(rdBuf, 1, this-&gt;len, fp);     <span class="comment">// store data from read buffer</span>
00419     <span class="keywordflow">if</span> (n != this-&gt;len)
00420     {
00421         <span class="keywordflow">if</span> (verbose)
00422             cout&lt;&lt;<span class="stringliteral">"ERROR! Writing file: "</span>&lt;&lt;fName&lt;&lt;endl;
00423         ret = <span class="keyword">false</span>;
00424     }
00425     <span class="keywordflow">else</span>
00426     {
00427         <span class="keywordflow">if</span> (verbose)
00428             cout&lt;&lt;<span class="stringliteral">"EBR: "</span>&lt;&lt;dec&lt;&lt;n&lt;&lt;<span class="stringliteral">" bytes loaded into "</span>&lt;&lt;fName&lt;&lt;endl;
00429     }
00430     fclose(fp);
00431     <span class="keyword">delete</span> rdBuf;
00432     <span class="keywordflow">return</span>(ret);
00433 }
00434 
00435 
00436 
<a name="l00445"></a><a class="code" href="class_lattice_semi___p_c_ie_1_1_mem.html#a9">00445</a> <span class="keywordtype">bool</span> <a class="code" href="class_lattice_semi___p_c_ie_1_1_mem.html#a9">Mem::set</a>(uint32_t offset, size_t num, <span class="keywordtype">void</span> *buf)
00446 {
00447     <span class="keywordflow">if</span> (num &gt; this-&gt;len)
00448         <span class="keywordflow">return</span>(<span class="keyword">false</span>);
00449 
00450     <span class="keywordflow">switch</span> (accessWidth)
00451     {
00452             <span class="keywordflow">case</span> 8:
00453                 this-&gt;<a class="code" href="class_lattice_semi___p_c_ie_1_1_device.html#a4">write8</a>(offset, (uint8_t *)buf, num);
00454                 <span class="keywordflow">break</span>;
00455 
00456             <span class="keywordflow">case</span> 16:
00457                 this-&gt;<a class="code" href="class_lattice_semi___p_c_ie_1_1_device.html#a6">write16</a>(offset, (uint16_t *)buf, num/2);
00458                 <span class="keywordflow">break</span>;
00459 
00460             <span class="keywordflow">case</span> 32:
00461                 this-&gt;<a class="code" href="class_lattice_semi___p_c_ie_1_1_device.html#a8">write32</a>(offset, (uint32_t *)buf, num/4);
00462                 <span class="keywordflow">break</span>;
00463 
00464             <span class="keywordflow">default</span>:
00465                 ERRORSTR(<span class="stringliteral">"Mem::set: Invalid accessSize"</span>);
00466                 <span class="keywordflow">return</span>(<span class="keyword">false</span>);   <span class="comment">// bad size</span>
00467                 <span class="keywordflow">break</span>;
00468     }
00469 
00470     <span class="keywordflow">return</span>(<span class="keyword">true</span>);
00471 }
00472 
<a name="l00482"></a><a class="code" href="class_lattice_semi___p_c_ie_1_1_mem.html#a8">00482</a> <span class="keywordtype">bool</span> <a class="code" href="class_lattice_semi___p_c_ie_1_1_mem.html#a8">Mem::get</a>(uint32_t offset, size_t num, <span class="keywordtype">void</span> *buf)
00483 {
00484 
00485     <span class="keywordflow">if</span> (num &gt; this-&gt;len)
00486         <span class="keywordflow">return</span>(<span class="keyword">false</span>);
00487 
00488     <span class="keywordflow">switch</span> (accessWidth)
00489     {
00490             <span class="keywordflow">case</span> 8:
00491                 this-&gt;<a class="code" href="class_lattice_semi___p_c_ie_1_1_device.html#a3">read8</a>(offset, (uint8_t *)buf, num);
00492                 <span class="keywordflow">break</span>;
00493 
00494             <span class="keywordflow">case</span> 16:
00495                 this-&gt;<a class="code" href="class_lattice_semi___p_c_ie_1_1_device.html#a5">read16</a>(offset, (uint16_t *)buf, num/2);
00496                 <span class="keywordflow">break</span>;
00497 
00498             <span class="keywordflow">case</span> 32:
00499                 this-&gt;<a class="code" href="class_lattice_semi___p_c_ie_1_1_device.html#a7">read32</a>(offset, (uint32_t *)buf, num/4);
00500                 <span class="keywordflow">break</span>;
00501 
00502             <span class="keywordflow">default</span>:
00503                 ERRORSTR(<span class="stringliteral">"Mem::get: Invalid accessSize"</span>);
00504                 <span class="keywordflow">return</span>(<span class="keyword">false</span>);   <span class="comment">// bad size</span>
00505                 <span class="keywordflow">break</span>;
00506     }
00507 
00508     <span class="keywordflow">return</span>(<span class="keyword">true</span>);
00509 }
00510 
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Wed Jul 16 12:05:26 2008 for Lattice PCIe API Manual by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.3.9.1 </small></address>
</body>
</html>
