<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>Lattice PCIe Thruput Demo: SFIF_menu.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.9.1 -->
<div class="qindex"><a class="qindex" href="main.html">Main&nbsp;Page</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a></div>
<div class="nav">
<a class="el" href="dir_000002.html">SFIF_menu</a></div>
<h1>SFIF_menu.cpp</h1><a href="_s_f_i_f__menu_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment">00001 <span class="comment">/*</span>
00002 <span class="comment"> *  COPYRIGHT (c) 2008 by Lattice Semiconductor Corporation</span>
00003 <span class="comment"> *</span>
00004 <span class="comment"> * All rights reserved. All use of this software and documentation is</span>
00005 <span class="comment"> * subject to the License Agreement located in the file LICENSE.</span>
00006 <span class="comment"> */</span>
00076 <span class="preprocessor">#include &lt;cstdlib&gt;</span>
00077 <span class="preprocessor">#include &lt;iostream&gt;</span>
00078 <span class="preprocessor">#include &lt;string&gt;</span>
00079 <span class="preprocessor">#include &lt;exception&gt;</span>
00080 
00081 <span class="preprocessor">#include &lt;stdio.h&gt;</span>
00082 <span class="preprocessor">#include &lt;stdlib.h&gt;</span>
00083 <span class="preprocessor">#include &lt;string.h&gt;</span>
00084 
00085 
00086 <span class="keyword">using</span> <span class="keyword">namespace </span>std;
00087 
00088 
00089 <span class="preprocessor">#include "PCIeAPI.h"</span>         <span class="comment">// the APIs</span>
00090 <span class="preprocessor">#include "LSCPCIe2_IF.h"</span>     <span class="comment">// the driver interface</span>
00091 <span class="preprocessor">#include "GPIO.h"</span>            <span class="comment">// the GPIO IP module</span>
00092 <span class="preprocessor">#include "SFIF.h"</span>            <span class="comment">// the SFIF IP module</span>
00093 <span class="preprocessor">#include "MiscUtils.h"</span>
00094 <span class="preprocessor">#include "MemFormat.h"</span>
00095 <span class="preprocessor">#include "../MemMap.h"</span>       <span class="comment">// IP module base addresses</span>
00096 
00097 
00098 
00100 <span class="comment">// Required to use Lattice PCIe methods</span>
00102 <span class="comment"></span><span class="keyword">using</span> <span class="keyword">namespace </span>LatticeSemi_PCIe;
00103 
00104 
00105 <span class="comment">/*==========================================================================*/</span>
00106 <span class="comment">/*==========================================================================*/</span>
00107 <span class="comment">/*==========================================================================*/</span>
00108 <span class="comment">/*               GLOBAL VARIABLES                                           */</span>
00109 <span class="comment">/*==========================================================================*/</span>
00110 <span class="comment">/*==========================================================================*/</span>
00111 <span class="comment">/*==========================================================================*/</span>
00112 
00113 LSCPCIe2_IF *pDrvr;
00114 SFIF        *pSFIF;
00115 GPIO        *pGPIO;
00116 
00117 <span class="comment">// Used for verifying access to driver Common DMA Buffer </span>
00118 uint32_t WriteDmaBuf[FIFO_SIZE/4];
00119 uint32_t ReadDmaBuf[FIFO_SIZE/4];
00120 
00121 <span class="comment">/*==========================================================================*/</span>
00122 <span class="comment">/*==========================================================================*/</span>
00123 <span class="comment">/*==========================================================================*/</span>
00124 <span class="comment">/*            FUNCTION PROTOTYPES                                           */</span>
00125 <span class="comment">/*==========================================================================*/</span>
00126 <span class="comment">/*==========================================================================*/</span>
00127 <span class="comment">/*==========================================================================*/</span>
00128 
00129 <span class="keywordtype">void</span>    <a class="code" href="_s_f_i_f__menu_8cpp.html#a5">writeTlpMenu</a>(<span class="keywordtype">void</span>);
00130 <span class="keywordtype">void</span>    <a class="code" href="_s_f_i_f__menu_8cpp.html#a6">readTlpMenu</a>(<span class="keywordtype">void</span>);
00131 <span class="keywordtype">void</span>    <a class="code" href="_s_f_i_f__menu_8cpp.html#a7">thruputTests</a>(<span class="keywordtype">void</span>);
00132 <span class="keywordtype">void</span>    <a class="code" href="_s_f_i_f__menu_8cpp.html#a8">changeConfigSettings</a>(<span class="keywordtype">void</span>);
00133 <span class="keywordtype">void</span>    <a class="code" href="_s_f_i_f__menu_8cpp.html#a9">GPIOTest</a>(<span class="keywordtype">void</span>);
00134 <span class="keywordtype">void</span>    <a class="code" href="_s_f_i_f__menu_8cpp.html#a10">showSFIFCounters</a>(SFIF::SFIFCntrs_t &amp;sfifCnts);
00135 
00136 <span class="comment">/*==========================================================================*/</span>
00137 <span class="comment">/*==========================================================================*/</span>
00138 <span class="comment">/*==========================================================================*/</span>
00139 
00141 <span class="comment">//             Main Entry</span>
00143 <span class="comment"></span>
<a name="l00155"></a><a class="code" href="_s_f_i_f__menu_8cpp.html#a11">00155</a> <span class="keywordtype">int</span> <a class="code" href="_s_f_i_f__menu_8cpp.html#a11">main</a>(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> **argv, <span class="keywordtype">char</span> **env)
00156 {
00157     <span class="keywordtype">char</span> boardName[LSC_PCIE_BOARD_NAME_LEN + 1];
00158     <span class="keywordtype">char</span> demoName[LSC_PCIE_DEMO_NAME_LEN + 1];
00159     uint32_t boardNum;
00160     string infoStr;
00161     uint32_t rd32_val;
00162 
00163     uint32_t ui;
00164     <span class="keywordtype">int</span> i;
00165     <span class="keywordtype">char</span> line[80];
00166 
00167 
00168     cout&lt;&lt;<span class="stringliteral">"\n\n========================================================\n"</span>;
00169     cout&lt;&lt;<span class="stringliteral">"           Lattice PCIe SFIF Menu\n"</span>;
00170     cout&lt;&lt;<span class="stringliteral">"                 ver2.0.0\n"</span>;
00171     cout&lt;&lt;<span class="stringliteral">"========================================================\n"</span>;
00172 
00173 
00174     cout&lt;&lt;<span class="stringliteral">"\n\n======================================\n"</span>;
00175     cout&lt;&lt;<span class="stringliteral">"    Instantiate the PCIeAPI DLL class\n"</span>;
00176     cout&lt;&lt;    <span class="stringliteral">"======================================\n"</span>;
00177     PCIeAPI theDLL;
00178     cout&lt;&lt;<span class="stringliteral">"Dll version info: "</span>&lt;&lt;theDLL.getVersionStr()&lt;&lt;endl;
00179 
00180     <span class="comment">// Setup so lots of diag output occurs from tests</span>
00181     theDLL.setRunTimeCtrl(PCIeAPI::VERBOSE);
00182 
00183     <span class="comment">// Get the environment variables needed to open the desired board</span>
00184     <span class="comment">// Pre-load with defaults</span>
00185     strcpy(boardName, <span class="stringliteral">"ven_1204&amp;dev_5303"</span>);
00186     strcpy(demoName, <span class="stringliteral">"subsys_30301204"</span>);
00187     <span class="keywordflow">if</span> (!GetPCIeEnvVars(boardName, demoName, boardNum))
00188         cout&lt;&lt;<span class="stringliteral">"\nEnvVars not found.  Using defaults.\n"</span>;
00189 
00190     cout&lt;&lt;<span class="stringliteral">"boardName = "</span>&lt;&lt;boardName&lt;&lt;endl;
00191     cout&lt;&lt;<span class="stringliteral">"boardNum = "</span>&lt;&lt;boardNum&lt;&lt;endl;
00192     cout&lt;&lt;<span class="stringliteral">"demoName = "</span>&lt;&lt;demoName&lt;&lt;endl;
00193 
00194 
00195     <span class="keywordflow">try</span>
00196     {
00197         cout&lt;&lt;<span class="stringliteral">"\n\n======================================\n"</span>;
00198         cout&lt;&lt;    <span class="stringliteral">"       Driver Interface Info\n"</span>;
00199         cout&lt;&lt;    <span class="stringliteral">"======================================\n"</span>;
00200         cout&lt;&lt;<span class="stringliteral">"Opening LSCPCIe2_IF...\n"</span>;
00201         pDrvr = <span class="keyword">new</span> LSCPCIe2_IF(boardName, 
00202                                 demoName, 
00203                                 boardNum);
00204 
00205         cout&lt;&lt;<span class="stringliteral">"OK.\n"</span>;
00206 
00207         pDrvr-&gt;getDriverVersionStr(infoStr);
00208         cout&lt;&lt;<span class="stringliteral">"Version: "</span>&lt;&lt;infoStr&lt;&lt;endl;
00209         pDrvr-&gt;getDriverResourcesStr(infoStr);
00210         cout&lt;&lt;<span class="stringliteral">"Resources: "</span>&lt;&lt;infoStr&lt;&lt;endl;
00211         pDrvr-&gt;getPCICapabiltiesStr(infoStr);
00212         cout&lt;&lt;<span class="stringliteral">"Link Info: "</span>&lt;&lt;infoStr&lt;&lt;endl;
00213 
00214 
00215         <span class="comment">//==================================================</span>
00216         <span class="comment">//  lscpcie2 Driver Info Test</span>
00217         <span class="comment">//==================================================</span>
00218         cout&lt;&lt;<span class="stringliteral">"\n\n"</span>;
00219         cout&lt;&lt;<span class="stringliteral">"==========================================\n"</span>;
00220         cout&lt;&lt;<span class="stringliteral">"  Step #1: get PCIe resources\n"</span>;
00221         cout&lt;&lt;<span class="stringliteral">"==========================================\n"</span>;
00222 
00223         <span class="keyword">const</span> PCIResourceInfo_t *pInfo;
00224         pDrvr-&gt;getPCIDriverInfo(&amp;pInfo);
00225         cout&lt;&lt;<span class="stringliteral">"lscpcie Driver Info:\n"</span>;
00226         cout&lt;&lt;<span class="stringliteral">"numBARs = "</span>&lt;&lt;pInfo-&gt;numBARs&lt;&lt;endl;
00227         <span class="keywordflow">for</span> (ui = 0; ui &lt; MAX_PCI_BARS; ui++)
00228         {
00229             <span class="keywordflow">if</span> (ui &gt;= pInfo-&gt;numBARs)
00230                 cout&lt;&lt;<span class="stringliteral">"***"</span>;  <span class="comment">// not initialized</span>
00231             cout&lt;&lt;<span class="stringliteral">"\tBAR"</span>&lt;&lt;ui&lt;&lt;<span class="stringliteral">":"</span>;
00232             cout&lt;&lt;<span class="stringliteral">"  nbar="</span>&lt;&lt;pInfo-&gt;BAR[ui].nBAR;
00233             cout&lt;&lt;<span class="stringliteral">"  type="</span>&lt;&lt;(int)pInfo-&gt;BAR[ui].type;
00234             cout&lt;&lt;<span class="stringliteral">"  size="</span>&lt;&lt;pInfo-&gt;BAR[ui].size;
00235             cout&lt;&lt;<span class="stringliteral">"  Addr="</span>&lt;&lt;hex&lt;&lt;pInfo-&gt;BAR[ui].physStartAddr&lt;&lt;dec;
00236             cout&lt;&lt;<span class="stringliteral">"  mapped="</span>&lt;&lt;pInfo-&gt;BAR[ui].memMapped;
00237             cout&lt;&lt;<span class="stringliteral">"  flags="</span>&lt;&lt;pInfo-&gt;BAR[ui].flags&lt;&lt;endl;
00238         }
00239         cout&lt;&lt;<span class="stringliteral">"hasInterrupt="</span>&lt;&lt;pInfo-&gt;hasInterrupt&lt;&lt;endl;
00240         cout&lt;&lt;<span class="stringliteral">"intrVector="</span>&lt;&lt;pInfo-&gt;intrVector&lt;&lt;endl;
00241 
00242 
00243         pDrvr-&gt;getPCIExtraInfoStr(infoStr);
00244         cout&lt;&lt;<span class="stringliteral">"\n\nDevice Driver Info:\n"</span>&lt;&lt;infoStr&lt;&lt;endl;
00245 
00246         <span class="keyword">const</span> ExtraResourceInfo_t *pExtra;
00247         pDrvr-&gt;getPciDriverExtraInfo(&amp;pExtra);
00248 
00249         <span class="keywordflow">if</span> (pExtra-&gt;DmaBufSize &lt; FIFO_SIZE)
00250         {
00251             cout&lt;&lt;<span class="stringliteral">"!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!\n"</span>;
00252             cout&lt;&lt;<span class="stringliteral">"            ERROR\n"</span>;
00253             cout&lt;&lt;<span class="stringliteral">"!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!\n"</span>;
00254             cout&lt;&lt;<span class="stringliteral">"\nDMA Common Buffer smaller than SFIF TX FIFO\n"</span>;
00255             cout&lt;&lt;<span class="stringliteral">"Exiting to avoid possible buffer overflows.\n"</span>;
00256             exit(-1);
00257         }
00258 
00259         <span class="keywordflow">if</span> (pExtra-&gt;DmaPhyAddrLo % 4096)
00260         {
00261             cout&lt;&lt;<span class="stringliteral">"!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!\n"</span>;
00262             cout&lt;&lt;<span class="stringliteral">"WARNING!  DMA Common Buffer Base is not 4kB aligned.\n"</span>;
00263             cout&lt;&lt;<span class="stringliteral">"!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!\n"</span>;
00264             cout&lt;&lt;<span class="stringliteral">"\nNo support to handle crossing 4kB address boundary\n"</span>;
00265             cout&lt;&lt;<span class="stringliteral">"Continue? (y/n): "</span>;
00266             cin&gt;&gt;line;
00267             <span class="keywordflow">if</span> (line[0] != <span class="charliteral">'y'</span>)
00268                 exit(-1);
00269         }
00270 
00271         <span class="keywordflow">if</span> (pExtra-&gt;DmaPhyAddrLo % 128)
00272         {
00273             cout&lt;&lt;<span class="stringliteral">"!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!\n"</span>;
00274             cout&lt;&lt;<span class="stringliteral">"WARNING!  Base is not 128 aligned.\n"</span>;
00275             cout&lt;&lt;<span class="stringliteral">"Writes need to account for crossing 4k boundary\n"</span>;
00276             cout&lt;&lt;<span class="stringliteral">"!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!\n"</span>;
00277             cout&lt;&lt;<span class="stringliteral">"\nNo support to handle crossing 4kB address boundary\n"</span>;
00278             cout&lt;&lt;<span class="stringliteral">"Continue? (y/n): "</span>;
00279             cin&gt;&gt;line;
00280             <span class="keywordflow">if</span> (line[0] != <span class="charliteral">'y'</span>)
00281                 exit(-1);
00282         }
00283 
00284 
00285         <span class="comment">//==================================================</span>
00286         <span class="comment">//  lscpcie2 Driver DMA Buf access test</span>
00287         <span class="comment">//==================================================</span>
00288         cout&lt;&lt;<span class="stringliteral">"\n\n"</span>;
00289         cout&lt;&lt;<span class="stringliteral">"=======================================================\n"</span>;
00290         cout&lt;&lt;<span class="stringliteral">"  Step #2: Test Read/Write DMA Sys buf from User Space\n"</span>;
00291         cout&lt;&lt;<span class="stringliteral">"=======================================================\n"</span>;
00292 
00293         cout&lt;&lt;<span class="stringliteral">"Testing accessing DMA Sys Buf from User space"</span>&lt;&lt;endl;
00294         cout&lt;&lt;<span class="stringliteral">"Filling WriteBuf with 0xa5\n"</span>;
00295         <span class="keywordflow">for</span> (i = 0; i &lt; 1024; i++)
00296             WriteDmaBuf[i] = (i&lt;&lt;16) | i;
00297         cout&lt;&lt;<span class="stringliteral">"Calling driver to write DMA common buf\n"</span>;
00298         pDrvr-&gt;writeSysDmaBuf(WriteDmaBuf, 4096);
00299 
00300         cout&lt;&lt;<span class="stringliteral">"Clearing ReadBuf\n"</span>;
00301         memset(ReadDmaBuf, 0x00, 4096);
00302         cout&lt;&lt;<span class="stringliteral">"Calling driver to read DMA common buf\n"</span>;
00303         pDrvr-&gt;readSysDmaBuf(ReadDmaBuf, 4096);
00304         <span class="keywordflow">for</span> (i = 0; i &lt; 1024; i++)
00305         {
00306             <span class="keywordflow">if</span> (ReadDmaBuf[i] != WriteDmaBuf[i])
00307                 cout&lt;&lt;<span class="stringliteral">"ERROR! DMA Read != Write"</span>&lt;&lt;endl;
00308         }
00309         cout&lt;&lt;<span class="stringliteral">"PASS\n"</span>;
00310 
00311         <span class="comment">//==================================================</span>
00312         <span class="comment">// Access GPIO</span>
00313         <span class="comment">//==================================================</span>
00314         cout&lt;&lt;<span class="stringliteral">"\n\n"</span>;
00315         cout&lt;&lt;<span class="stringliteral">"=======================================================\n"</span>;
00316         cout&lt;&lt;<span class="stringliteral">"  Step #3: Create GPIO device object and test\n"</span>;
00317         cout&lt;&lt;<span class="stringliteral">"=======================================================\n"</span>;
00318 
00319 
00320         pGPIO = <span class="keyword">new</span> GPIO(<span class="stringliteral">"GPIO"</span>,         <span class="comment">// a unique name for the IP module instance</span>
00321                          memGPIO(0),    <span class="comment">// its base address</span>
00322                          pDrvr);        <span class="comment">// driver interface to use for register access</span>
00323 
00324         <a class="code" href="_s_f_i_f__menu_8cpp.html#a9">GPIOTest</a>();
00325 
00326 
00327         <span class="comment">//==================================================</span>
00328         <span class="comment">// Access SFIF </span>
00329         <span class="comment">//==================================================</span>
00330         cout&lt;&lt;<span class="stringliteral">"\n\n"</span>;
00331         cout&lt;&lt;<span class="stringliteral">"=======================================================\n"</span>;
00332         cout&lt;&lt;<span class="stringliteral">"  Step #4: Create SFIF device object and test\n"</span>;
00333         cout&lt;&lt;<span class="stringliteral">"=======================================================\n"</span>;
00334 
00335         pSFIF = <span class="keyword">new</span> SFIF(<span class="stringliteral">"SFIF"</span>,         <span class="comment">// a unique name for the IP module instance</span>
00336                          memSFIF(0),    <span class="comment">// its base address</span>
00337                          pDrvr);        <span class="comment">// driver interface to use for register access</span>
00338 
00339         <span class="comment">// Display all the SFIF register values for visual check</span>
00340         pSFIF-&gt;showRegs();
00341 
00342         cout&lt;&lt;<span class="stringliteral">"\nWrite ICG_Count = 0xbeef\n"</span>;
00343         pSFIF-&gt;write32(0x08, 0xbeef);
00344         cout&lt;&lt;<span class="stringliteral">"Read TX_ICG: SFIF[8] = "</span>;
00345         rd32_val = pSFIF-&gt;read32(0x08);
00346         cout&lt;&lt;hex&lt;&lt;rd32_val&lt;&lt;dec&lt;&lt;endl;
00347         <span class="keywordflow">if</span> (rd32_val != 0xbeef)
00348         {
00349             cout&lt;&lt;<span class="stringliteral">"ERROR! Did not read back what was written!\n"</span>;
00350         }
00351         <span class="keywordflow">else</span>
00352         {
00353             cout&lt;&lt;<span class="stringliteral">"PASS\n"</span>;
00354         }
00355 
00356 
00357         <span class="keywordtype">bool</span> done = <span class="keyword">false</span>;
00358         <span class="keywordflow">while</span> (!done)
00359         {
00360             cout&lt;&lt;<span class="stringliteral">"\n\n"</span>;
00361             cout&lt;&lt;<span class="stringliteral">"==================================================\n"</span>;
00362             cout&lt;&lt;<span class="stringliteral">"            SFIF Menu\n"</span>;
00363             cout&lt;&lt;<span class="stringliteral">"==================================================\n"</span>;
00364             cout&lt;&lt;<span class="stringliteral">"R = (Read) MRd TLP Menu\n"</span>;
00365             cout&lt;&lt;<span class="stringliteral">"W = (Write) MWr TLP Menu\n"</span>;
00366             cout&lt;&lt;<span class="stringliteral">"T = Thruput Tests\n"</span>;
00367             cout&lt;&lt;<span class="stringliteral">"G = GPIO Module Tests\n"</span>;
00368             cout&lt;&lt;<span class="stringliteral">"S = SFIF Register Status\n"</span>;
00369             cout&lt;&lt;<span class="stringliteral">"P = PCIe Link Settings\n"</span>; 
00370             cout&lt;&lt;<span class="stringliteral">"C = Change TLP Configuration Settings\n"</span>; 
00371             cout&lt;&lt;<span class="stringliteral">"D = Display contents of DMA Common buf\n"</span>;
00372             cout&lt;&lt;<span class="stringliteral">"x = Exit\n"</span>;
00373             cout&lt;&lt;<span class="stringliteral">"-&gt; "</span>;
00374             cin&gt;&gt;line;
00375 
00376             <span class="keywordflow">switch</span> (line[0])
00377             {
00378                 <span class="keywordflow">case</span> <span class="charliteral">'r'</span>:
00379                 <span class="keywordflow">case</span> <span class="charliteral">'R'</span>:
00380                     <a class="code" href="_s_f_i_f__menu_8cpp.html#a6">readTlpMenu</a>();
00381                     <span class="keywordflow">break</span>;
00382 
00383                 <span class="keywordflow">case</span> <span class="charliteral">'w'</span>:
00384                 <span class="keywordflow">case</span> <span class="charliteral">'W'</span>:
00385                     <a class="code" href="_s_f_i_f__menu_8cpp.html#a5">writeTlpMenu</a>();
00386                     <span class="keywordflow">break</span>;
00387 
00388                 <span class="keywordflow">case</span> <span class="charliteral">'g'</span>:
00389                 <span class="keywordflow">case</span> <span class="charliteral">'G'</span>:
00390                     <a class="code" href="_s_f_i_f__menu_8cpp.html#a9">GPIOTest</a>();
00391                     <span class="keywordflow">break</span>;
00392 
00393                 <span class="keywordflow">case</span> <span class="charliteral">'t'</span>:
00394                 <span class="keywordflow">case</span> <span class="charliteral">'T'</span>:
00395                     <a class="code" href="_s_f_i_f__menu_8cpp.html#a7">thruputTests</a>();
00396                     <span class="keywordflow">break</span>;
00397 
00398                 <span class="keywordflow">case</span> <span class="charliteral">'d'</span>:
00399                 <span class="keywordflow">case</span> <span class="charliteral">'D'</span>:
00400                     cout&lt;&lt;<span class="stringliteral">"\nSystem Common Buffer Contents Display"</span>;
00401                     pDrvr-&gt;readSysDmaBuf(ReadDmaBuf, FIFO_SIZE);
00402                     cout&lt;&lt;hex;
00403                     <span class="keywordflow">for</span> (i = 0; i &lt; FIFO_SIZE/4; i++)
00404                     {
00405                         <span class="keywordflow">if</span> ((i % 4) == 0)
00406                             printf(<span class="stringliteral">"\n%04X:  "</span>, i*4);
00407                         printf(<span class="stringliteral">"%08X  "</span>, ReadDmaBuf[i]);
00408                     }
00409                     cout&lt;&lt;dec;
00410                     <span class="keywordflow">break</span>;
00411 
00412                 <span class="keywordflow">case</span> <span class="charliteral">'c'</span>:
00413                 <span class="keywordflow">case</span> <span class="charliteral">'C'</span>:
00414                     <a class="code" href="_s_f_i_f__menu_8cpp.html#a8">changeConfigSettings</a>();
00415                     <span class="keywordflow">break</span>;
00416 
00417                 <span class="keywordflow">case</span> <span class="charliteral">'p'</span>:
00418                 <span class="keywordflow">case</span> <span class="charliteral">'P'</span>:
00419                     <span class="comment">//showPCIeSettings(pWBM);</span>
00420                     pDrvr-&gt;getPCIResourcesStr(infoStr);
00421                     cout&lt;&lt;infoStr&lt;&lt;endl;
00422                     pDrvr-&gt;getPCICapabiltiesStr(infoStr);
00423                     cout&lt;&lt;infoStr&lt;&lt;endl;
00424                     pDrvr-&gt;getPCIExtraInfoStr(infoStr);
00425                     cout&lt;&lt;infoStr&lt;&lt;endl;
00426                     <span class="keywordflow">break</span>;
00427 
00428                 <span class="keywordflow">case</span> <span class="charliteral">'s'</span>:
00429                 <span class="keywordflow">case</span> <span class="charliteral">'S'</span>:
00430                     cout&lt;&lt;<span class="stringliteral">"\n\n"</span>;
00431                     cout&lt;&lt;<span class="stringliteral">"============================\n"</span>;
00432                     cout&lt;&lt;<span class="stringliteral">"  Read SFIF Registers\n"</span>;
00433                     cout&lt;&lt;<span class="stringliteral">"============================\n"</span>;
00434                     pSFIF-&gt;showRegs();
00435 
00436                     cout&lt;&lt;<span class="stringliteral">"\nRoot Complex Initial Credits:"</span>&lt;&lt;endl;
00437                     cout&lt;&lt;<span class="stringliteral">"PD_CA (Wr): "</span>&lt;&lt;((pGPIO-&gt;read32(0x24))&gt;&gt;16)&lt;&lt;endl;
00438                     cout&lt;&lt;<span class="stringliteral">"NPH_CA(Rd): "</span>&lt;&lt;((pGPIO-&gt;read32(0x24)) &amp; 0xffff)&lt;&lt;endl;
00439                     <span class="keywordflow">break</span>;
00440 
00441                 <span class="keywordflow">case</span> <span class="charliteral">'x'</span>:
00442                 <span class="keywordflow">case</span> <span class="charliteral">'X'</span>:
00443                     done = <span class="keyword">true</span>;
00444                     <span class="keywordflow">break</span>;
00445             }
00446         }
00447 
00448     }
00449     <span class="keywordflow">catch</span> (std::exception &amp;e)
00450     {
00451         cout&lt;&lt;<span class="stringliteral">"\n!!!ERROR!!! Testing Halted with errors: "</span>&lt;&lt;e.what()&lt;&lt;endl;
00452     }
00453 
00454     cout&lt;&lt;<span class="stringliteral">"\nEnd."</span>&lt;&lt;endl;
00455 
00456     <span class="keyword">delete</span> pSFIF;
00457     <span class="keyword">delete</span> pGPIO;
00458     <span class="keyword">delete</span> pDrvr;
00459 }
00460 
00461 
00462 
00463 
<a name="l00468"></a><a class="code" href="_s_f_i_f__menu_8cpp.html#a9">00468</a> <span class="keywordtype">void</span> <a class="code" href="_s_f_i_f__menu_8cpp.html#a9">GPIOTest</a>(<span class="keywordtype">void</span>)
00469 {
00470     <span class="keywordtype">int</span> i;
00471     uint32_t wr_val, rd_val;
00472     <span class="keywordtype">char</span> line[80];
00473 
00474     cout&lt;&lt;<span class="stringliteral">"\n\n"</span>;
00475     cout&lt;&lt;<span class="stringliteral">"==================================================\n"</span>;
00476     cout&lt;&lt;<span class="stringliteral">"        Test Basic GPIO IP Module Access\n"</span>;
00477     cout&lt;&lt;<span class="stringliteral">"==================================================\n"</span>;
00478     cout&lt;&lt;<span class="stringliteral">"\nLook For GPIO ID: "</span>;   
00479     cout&lt;&lt;<span class="stringliteral">"Read32: GPIO[0] = "</span>;
00480     uint32_t rd32_val = pGPIO-&gt;getID();
00481     cout&lt;&lt;hex&lt;&lt;rd32_val&lt;&lt;dec&lt;&lt;endl;
00482     <span class="keywordflow">if</span> (rd32_val != 0x12043010)
00483     {
00484         cout&lt;&lt;<span class="stringliteral">"ERROR! GPIO module ID does not match 0x12043010!\n"</span>;
00485         cout&lt;&lt;<span class="stringliteral">"Aborting further GPIO tests."</span>&lt;&lt;endl;
00486         cout&lt;&lt;<span class="stringliteral">"Continue? (y/n): "</span>;
00487         cin&gt;&gt;line;
00488         <span class="keywordflow">if</span> (line[0] != <span class="charliteral">'y'</span>)
00489             <span class="keywordflow">return</span>;
00490     }
00491 
00492     cout&lt;&lt;<span class="stringliteral">"ScratchPad Wr/Rd/Verify: "</span>;
00493     wr_val = rand();
00494     pGPIO-&gt;setScratchPad(wr_val);
00495     rd_val = pGPIO-&gt;getScratchPad();
00496     <span class="keywordflow">if</span> (wr_val == rd_val)
00497         cout&lt;&lt;<span class="stringliteral">"PASS"</span>&lt;&lt;endl;
00498     <span class="keywordflow">else</span>
00499         cout&lt;&lt;<span class="stringliteral">"FAIL!!!"</span>&lt;&lt;endl;
00500 
00501 
00502     <span class="comment">// Light LED segments to visually show access is working</span>
00503     cout&lt;&lt;<span class="stringliteral">"\nLED Segment Test: "</span>;   
00504     <span class="keywordflow">for</span> (i = 0; i &lt; 16; i++)
00505     {
00506         pGPIO-&gt;setLED16Display((uint16_t)(1&lt;&lt;i));
00507         Sleep(100);
00508     }
00509 }
00510 
00511 
00512 
<a name="l00517"></a><a class="code" href="_s_f_i_f__menu_8cpp.html#a8">00517</a> <span class="keywordtype">void</span> <a class="code" href="_s_f_i_f__menu_8cpp.html#a8">changeConfigSettings</a>(<span class="keywordtype">void</span>)
00518 {
00519     uint32_t RlxOrdBit = 1;
00520     uint32_t SnoopBit = 0;
00521     uint32_t PoisonedBit = 0;
00522     uint32_t TrafficClassBits = 0;
00523     uint32_t temp;
00524     <span class="keywordtype">char</span> str[16];
00525 
00526     fflush(stdin);
00527     cout&lt;&lt;<span class="stringliteral">"\n==================================================\n"</span>;
00528     cout&lt;&lt;<span class="stringliteral">"       TLP Configuration Settings\n"</span>;
00529     cout&lt;&lt;<span class="stringliteral">"       Settings apply to all TLPs\n"</span>;
00530     cout&lt;&lt;<span class="stringliteral">"==================================================\n"</span>;
00531     cout&lt;&lt;<span class="stringliteral">"Relaxed Ordering(1/0=default): "</span>&lt;&lt;RlxOrdBit&lt;&lt;<span class="stringliteral">"   "</span>;
00532     str[0] = <span class="charliteral">'\0'</span>;
00533     fgets(str, 8, stdin);
00534     <span class="keywordflow">if</span> ((str[0] == <span class="charliteral">'0'</span>) || (str[0] == <span class="charliteral">'1'</span>))
00535     {
00536         RlxOrdBit = str[0] - <span class="charliteral">'0'</span>;  <span class="comment">// 1 or 0</span>
00537     }
00538 
00539     cout&lt;&lt;<span class="stringliteral">"No Cache Snoop(1/0=default): "</span>&lt;&lt;SnoopBit&lt;&lt;<span class="stringliteral">"   "</span>;
00540     str[0] = <span class="charliteral">'\0'</span>;
00541     fgets(str, 8, stdin);
00542     <span class="keywordflow">if</span> ((str[0] == <span class="charliteral">'0'</span>) || (str[0] == <span class="charliteral">'1'</span>))
00543     {
00544         SnoopBit = str[0] - <span class="charliteral">'0'</span>;  <span class="comment">// 1 or 0</span>
00545     }
00546 
00547     cout&lt;&lt;<span class="stringliteral">"Poisoned Payload(1/0=default): "</span>&lt;&lt;PoisonedBit&lt;&lt;<span class="stringliteral">"   "</span>;
00548     str[0] = <span class="charliteral">'\0'</span>;
00549     fgets(str, 8, stdin);
00550     <span class="keywordflow">if</span> ((str[0] == <span class="charliteral">'0'</span>) || (str[0] == <span class="charliteral">'1'</span>))
00551     {
00552         PoisonedBit = str[0] - <span class="charliteral">'0'</span>;  <span class="comment">// 1 or 0</span>
00553     }
00554 
00555     cout&lt;&lt;<span class="stringliteral">"Traffic Class(7-0/0=default): "</span>&lt;&lt;TrafficClassBits&lt;&lt;<span class="stringliteral">"   "</span>;
00556     str[0] = <span class="charliteral">'\0'</span>;
00557     fgets(str, 8, stdin);
00558     <span class="keywordflow">if</span> (str[0] &gt; <span class="charliteral">' '</span>)
00559     {
00560         temp = atoi(str);
00561         <span class="keywordflow">if</span> (temp &lt;= 7)
00562             TrafficClassBits = temp;
00563     }
00564 
00565     pSFIF-&gt;cfgTLP(RlxOrdBit,  SnoopBit,  PoisonedBit,  TrafficClassBits );
00566 }
00567 
00568 
00569 
<a name="l00576"></a><a class="code" href="_s_f_i_f__menu_8cpp.html#a10">00576</a> <span class="keywordtype">void</span>    <a class="code" href="_s_f_i_f__menu_8cpp.html#a10">showSFIFCounters</a>(SFIF::SFIFCntrs_t &amp;sfifCnts)
00577 {
00578     cout&lt;&lt;<span class="stringliteral">"ELAPSED_CNT: SFIF[0x14] = "</span>&lt;&lt;dec&lt;&lt;sfifCnts.ElapsedTime &lt;&lt;endl;
00579     cout&lt;&lt;<span class="stringliteral">"TX_TLP_CNT: SFIF[0x18] = "</span>&lt;&lt;sfifCnts.TxTLPCnt&lt;&lt;endl;
00580     cout&lt;&lt;<span class="stringliteral">"RX_TLP_CNT: SFIF[0x1C] = "</span>&lt;&lt;sfifCnts.RxTLPCnt&lt;&lt;endl;
00581     cout&lt;&lt;<span class="stringliteral">"CREDIT_WR_PAUSE_CNT: SFIF[0x20] = "</span>&lt;&lt;sfifCnts.WrWaitTime&lt;&lt;endl;
00582     cout&lt;&lt;<span class="stringliteral">"LAST_CPLD_TS: SFIF[0x24] = "</span>&lt;&lt;sfifCnts.LastCplDTime&lt;&lt;endl;
00583     cout&lt;&lt;<span class="stringliteral">"CREDIT_RD_PAUSE_CNT: SFIF[0x28] = "</span>&lt;&lt;sfifCnts.RdWaitTime&lt;&lt;endl;
00584 }
00585 
00586 
<a name="l00595"></a><a class="code" href="_s_f_i_f__menu_8cpp.html#a5">00595</a> <span class="keywordtype">void</span>    <a class="code" href="_s_f_i_f__menu_8cpp.html#a5">writeTlpMenu</a>(<span class="keywordtype">void</span>)
00596 {
00597     uint32_t i;
00598     uint32_t cycles;
00599     uint32_t icg;
00600     uint32_t n, nPkts;
00601     uint32_t payloadSize;
00602     uint32_t numDWs;
00603     uint32_t wrAddr;
00604     <span class="keywordtype">double</span>   pauseRatio;
00605     <span class="keywordtype">double</span> thruput;
00606     SFIF::SFIFCntrs_t sfifCnts;
00607     <span class="keywordtype">char</span> line[80];
00608 
00609 
00610     <span class="keywordflow">while</span> (1)
00611     {
00612         wrAddr = 0;    <span class="comment">// Starting point in Sys Common buffer (offset)</span>
00613         cout&lt;&lt;<span class="stringliteral">"\n\n"</span>;
00614         cout&lt;&lt;<span class="stringliteral">"==================================================\n"</span>;
00615         cout&lt;&lt;<span class="stringliteral">"  Write a TLP(s) into system memory\n"</span>;
00616         cout&lt;&lt;<span class="stringliteral">"==================================================\n"</span>;
00617         cout&lt;&lt;<span class="stringliteral">"Payload Size(4,16,32,64,128): "</span>;
00618         cin&gt;&gt;payloadSize;
00619         <span class="keywordflow">switch</span> (payloadSize)
00620         {
00621             <span class="keywordflow">case</span> 4:
00622             <span class="keywordflow">case</span> 16:
00623             <span class="keywordflow">case</span> 32:
00624             <span class="keywordflow">case</span> 64:
00625             <span class="keywordflow">case</span> 128:
00626                 numDWs = payloadSize / 4;
00627                 <span class="keywordflow">break</span>;
00628             <span class="keywordflow">default</span>:
00629                 payloadSize = 4;
00630                 numDWs = 1;
00631         }
00632 
00633         cout&lt;&lt;<span class="stringliteral">"Tx pkts: "</span>;
00634         cin&gt;&gt;nPkts;
00635         cout&lt;&lt;<span class="stringliteral">"Tx cycles: "</span>;
00636         cin&gt;&gt;cycles;
00637         cout&lt;&lt;<span class="stringliteral">"ICG: "</span>;
00638         cin&gt;&gt;icg;
00639 
00640         <span class="keywordflow">if</span> (cycles &lt; 1)
00641             cycles = 1;
00642         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (cycles &gt; 0xffff)
00643             cycles = 0xffff;
00644 
00645 
00646         <span class="keywordflow">if</span> (((numDWs + 4) * 4 * nPkts) &gt; FIFO_SIZE)
00647         {
00648             nPkts = FIFO_SIZE / ((numDWs + 4) * 4);
00649             cout&lt;&lt;<span class="stringliteral">"Too large for TX FIFO.  Set to: "</span>&lt;&lt;nPkts&lt;&lt;endl;
00650         }
00651 
00652 
00653         <span class="comment">// Clear DMA common buffer done by SFIF class</span>
00654 
00655 
00656         pSFIF-&gt;setupSFIF(WRITE_CYC_MODE,  <span class="comment">// runMode</span>
00657                          MWR_TLPS,        <span class="comment">// trafficMode</span>
00658                          cycles, 
00659                          icg, 
00660                          0,             <span class="comment">// rdTLPSize</span>
00661                          payloadSize,  <span class="comment">// wrTLPSize</span>
00662                          0,             <span class="comment">// numRdTLPs</span>
00663                          nPkts);   <span class="comment">// numWrTLPs</span>
00664 
00665 
00666         pSFIF-&gt;startSFIF(<span class="keyword">false</span>);  <span class="comment">// not looping, just run the set many cycles</span>
00667 
00668         Sleep(1000);  <span class="comment">// Wait 1 second while SFIF runs</span>
00669 
00670         pSFIF-&gt;stopSFIF();
00671 
00672 
00673         pSFIF-&gt;getCntrs(sfifCnts);
00674         <a class="code" href="_s_f_i_f__menu_8cpp.html#a10">showSFIFCounters</a>(sfifCnts);
00675 
00676 
00677         pauseRatio = (double)sfifCnts.WrWaitTime / (double)sfifCnts.ElapsedTime;
00678         cout&lt;&lt;<span class="stringliteral">"Run-time waiting for MWr credits: "</span>&lt;&lt;(pauseRatio * 100.0)&lt;&lt;<span class="stringliteral">"%\n"</span>;
00679 
00680         <span class="keywordflow">if</span> (sfifCnts.ElapsedTime == 0xffffffff)
00681         {
00682             cout&lt;&lt;<span class="stringliteral">"ERROR!  Counters saturated.  Can't compute thruput.\n"</span>;
00683         }
00684         <span class="keywordflow">else</span>
00685         {
00686             thruput = ((payloadSize * sfifCnts.TxTLPCnt) / (8E-9 * sfifCnts.ElapsedTime)) / 1E6;
00687 
00688             cout&lt;&lt;<span class="stringliteral">"Write: "</span>&lt;&lt;(payloadSize * sfifCnts.TxTLPCnt)&lt;&lt;<span class="stringliteral">" bytes   Throughput: "</span>&lt;&lt;thruput&lt;&lt;<span class="stringliteral">" MB/s\n"</span>;
00689         }
00690 
00691         cout&lt;&lt;<span class="stringliteral">"Clearing ReadBuf\n"</span>;
00692         memset(ReadDmaBuf, 0x00, <span class="keyword">sizeof</span>(ReadDmaBuf));
00693         cout&lt;&lt;<span class="stringliteral">"Calling driver to read out "</span>&lt;&lt;numDWs * nPkts&lt;&lt;<span class="stringliteral">" words\n"</span>;
00694         pDrvr-&gt;readSysDmaBuf(ReadDmaBuf, payloadSize * nPkts);
00695 
00696         cout&lt;&lt;<span class="stringliteral">"Verifying contents transfered to User Space...\n"</span>;
00697         <span class="keywordflow">if</span> (pSFIF-&gt;verifyMWrXfer(ReadDmaBuf, payloadSize * nPkts))
00698             cout&lt;&lt;<span class="stringliteral">"PASSED!"</span>&lt;&lt;endl;
00699 
00700 
00701         cout&lt;&lt;<span class="stringliteral">"\nDisplay Rcvd data(y/n)? "</span>;
00702         cin&gt;&gt;line;
00703         <span class="keywordflow">if</span> (line[0] == <span class="charliteral">'y'</span>)
00704         {
00705             n = numDWs * nPkts;
00706             <span class="keywordflow">if</span> (n &gt; <span class="keyword">sizeof</span>(ReadDmaBuf) / 4)
00707                 n =  <span class="keyword">sizeof</span>(ReadDmaBuf) / 4;
00708             cout&lt;&lt;hex;
00709             <span class="keywordflow">for</span> (i = 0; i &lt; n; i++)
00710             {
00711                 <span class="keywordflow">if</span> ((i % 4) == 0)
00712                     printf(<span class="stringliteral">"\n%04X:  "</span>, i*4);
00713                 printf(<span class="stringliteral">"%08X  "</span>, ReadDmaBuf[i]);
00714             }
00715             cout&lt;&lt;dec;
00716         }
00717 
00718         cout&lt;&lt;<span class="stringliteral">"\n\nAgain(y/n)? "</span>;
00719         cin&gt;&gt;line;
00720         <span class="keywordflow">if</span> (line[0] != <span class="charliteral">'y'</span>)
00721             <span class="keywordflow">break</span>;
00722     }
00723 
00724 }
00725 
00726 
00727 
00728 
<a name="l00739"></a><a class="code" href="_s_f_i_f__menu_8cpp.html#a6">00739</a> <span class="keywordtype">void</span>    <a class="code" href="_s_f_i_f__menu_8cpp.html#a6">readTlpMenu</a>(<span class="keywordtype">void</span>)
00740 {
00741     uint32_t cycles;
00742     uint32_t icg;
00743     uint32_t nPkts;
00744     uint32_t readReqSize;
00745     uint32_t numDWs;
00746     uint64_t totalBytes;
00747     <span class="keywordtype">char</span> line[80];
00748     <span class="keywordtype">double</span>   pauseRatio;
00749     <span class="keywordtype">double</span>   thruput;
00750     string outs;
00751 
00752     SFIF::SFIFCntrs_t sfifCnts;
00753 
00754 
00755     <span class="keywordflow">while</span> (1)
00756     {
00757 
00758         cout&lt;&lt;<span class="stringliteral">"\n\n"</span>;
00759         cout&lt;&lt;<span class="stringliteral">"==================================================\n"</span>;
00760         cout&lt;&lt;<span class="stringliteral">"  Read a TLP(s) from system memory\n"</span>;
00761         cout&lt;&lt;<span class="stringliteral">"==================================================\n"</span>;
00762         cout&lt;&lt;<span class="stringliteral">"Read Request Size(4,16,32,64,128,256,512): "</span>;
00763         cin&gt;&gt;readReqSize;
00764         <span class="keywordflow">switch</span> (readReqSize)
00765         {
00766             <span class="keywordflow">case</span> 4:
00767             <span class="keywordflow">case</span> 16:
00768             <span class="keywordflow">case</span> 32:
00769             <span class="keywordflow">case</span> 64:
00770             <span class="keywordflow">case</span> 128:
00771             <span class="keywordflow">case</span> 256:
00772             <span class="keywordflow">case</span> 512:
00773                 numDWs = readReqSize / 4;
00774                 <span class="keywordflow">break</span>;
00775             <span class="keywordflow">default</span>:
00776                 readReqSize = 4;
00777                 numDWs = 1;
00778         }
00779 
00780         cout&lt;&lt;<span class="stringliteral">"Number MRd TLPs to send: "</span>;
00781         cin&gt;&gt;nPkts;
00782         <span class="keywordflow">if</span> (nPkts &gt; 32)
00783         {
00784             cout&lt;&lt;<span class="stringliteral">"NOTE: Max 32 outstanding TLPs."</span>&lt;&lt;endl;
00785             nPkts = 32;
00786         }
00787         cout&lt;&lt;<span class="stringliteral">"# Cycles of MRd pkts: "</span>;
00788         cin&gt;&gt;cycles;
00789         <span class="keywordflow">if</span> (cycles &gt;= 0x10000)
00790         {
00791             cout&lt;&lt;<span class="stringliteral">"NOTE: Max 64k cycles."</span>&lt;&lt;endl;
00792             cycles = 0xffff;
00793         }
00794         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (cycles &lt; 1)
00795             cycles = 1;
00796 
00797         cout&lt;&lt;<span class="stringliteral">"ICG: "</span>;
00798         cin&gt;&gt;icg;
00799 
00800         <span class="comment">// Put pattern to read in DMA common buffer done by SFIF class</span>
00801 
00802         pSFIF-&gt;setupSFIF(READ_CYC_MODE,  <span class="comment">// runMode</span>
00803                          MRD_TLPS,        <span class="comment">// trafficMode</span>
00804                          cycles, 
00805                          icg, 
00806                          readReqSize,  <span class="comment">// rdTLPSize</span>
00807                          0,            <span class="comment">// wrTLPSize</span>
00808                          nPkts,             <span class="comment">// numRdTLPs</span>
00809                          0);   <span class="comment">// numWrTLPs</span>
00810 
00811 
00812         pSFIF-&gt;startSFIF(<span class="keyword">false</span>);  <span class="comment">// not looping, just run the set many cycles</span>
00813 
00814         Sleep(1000);
00815 
00816         pSFIF-&gt;stopSFIF();
00817 
00818 
00819         pSFIF-&gt;getCntrs(sfifCnts);
00820         <a class="code" href="_s_f_i_f__menu_8cpp.html#a10">showSFIFCounters</a>(sfifCnts);
00821 
00822 
00823         <span class="comment">//pauseRatio = (double)sfifCnts.RdWaitTime / (double)sfifCnts.ElapsedTime;</span>
00824         pauseRatio = (double)sfifCnts.RdWaitTime / (double)sfifCnts.LastCplDTime;
00825         cout&lt;&lt;<span class="stringliteral">"Run-time waiting for MRd credits: "</span>&lt;&lt;(pauseRatio * 100.0)&lt;&lt;<span class="stringliteral">"%\n"</span>;
00826 
00827         <span class="keywordflow">if</span> (pSFIF-&gt;getSFIFParseRxFIFO(outs))
00828         {
00829             cout&lt;&lt;outs;
00830         }
00831         <span class="keywordflow">else</span>
00832         {
00833             cout&lt;&lt;<span class="stringliteral">"\n\nThruput estimate based on read request size, Rx TLP count and Last CplD time\n"</span>;
00834             <span class="keywordflow">if</span> (readReqSize &lt; RCB)
00835                 totalBytes = (uint64_t)readReqSize * (uint64_t)sfifCnts.RxTLPCnt;
00836             <span class="keywordflow">else</span>
00837                 totalBytes = (uint64_t)RCB * (uint64_t)sfifCnts.RxTLPCnt;
00838             thruput = (totalBytes / (8E-9 * sfifCnts.LastCplDTime)) / 1E6;
00839 
00840             cout&lt;&lt;<span class="stringliteral">"Recvd: "</span>&lt;&lt;dec&lt;&lt;totalBytes&lt;&lt;<span class="stringliteral">" bytes  in "</span>&lt;&lt;(8E-9 * sfifCnts.LastCplDTime)&lt;&lt;<span class="stringliteral">" secs   Throughput: "</span>&lt;&lt;thruput&lt;&lt;<span class="stringliteral">" MB/s\n"</span>;
00841         }
00842 
00843 
00844         cout&lt;&lt;<span class="stringliteral">"\n\nAgain(y/n)? "</span>;
00845         cin&gt;&gt;line;
00846         <span class="keywordflow">if</span> (line[0] != <span class="charliteral">'y'</span>)
00847             <span class="keywordflow">break</span>;
00848     }
00849 
00850 }
00851 
00852 
00853 
00854 
<a name="l00862"></a><a class="code" href="_s_f_i_f__menu_8cpp.html#a7">00862</a> <span class="keywordtype">void</span>    <a class="code" href="_s_f_i_f__menu_8cpp.html#a7">thruputTests</a>(<span class="keywordtype">void</span>)
00863 {
00864 
00865     uint32_t i;
00866     uint32_t cycles;
00867     uint32_t icg;
00868     uint32_t nPkts;
00869     uint32_t pktRdRatio, pktWrRatio;
00870     uint32_t numDWs, rdNumDWs, wrNumDWs;
00871     uint32_t payloadSize;
00872     uint32_t readReqSize;
00873     uint32_t msecRunTime;
00874     uint8_t mode;
00875     uint64_t totalBytes;
00876     <span class="keywordtype">double</span> thruput;
00877     <span class="keywordtype">double</span>   pauseRatio;
00878     SFIF::SFIFCntrs_t sfifCnts;
00879     <span class="keywordtype">char</span> line[80];
00880 
00881 
00882 
00883     cout&lt;&lt;<span class="stringliteral">"\n==================================================\n"</span>;
00884     cout&lt;&lt;<span class="stringliteral">"          Thruput Tests\n"</span>;
00885     cout&lt;&lt;<span class="stringliteral">"==================================================\n"</span>;
00886     cout&lt;&lt;<span class="stringliteral">"Test Duration (msec): "</span>;
00887     cin&gt;&gt;msecRunTime;
00888     <span class="keywordflow">if</span> (msecRunTime &gt; 30000)
00889     {
00890         cout&lt;&lt;<span class="stringliteral">"WARNING! Duration limitted to 30 secs or counters saturate.\n"</span>;
00891         msecRunTime = 30000;
00892     }
00893     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (msecRunTime &lt;= 0)
00894     {
00895         msecRunTime = 1;
00896     }
00897 
00898     cout&lt;&lt;<span class="stringliteral">"Mode (RWA=8|RW=4|Rd=2|Wr=1): "</span>;
00899     cin&gt;&gt;line;
00900     mode = atoi(line);
00901 
00902     <span class="keywordflow">if</span> ((mode &lt; 1) || (mode &gt; 15))
00903     {
00904         cout&lt;&lt;<span class="stringliteral">"Invalid selection.\n"</span>;
00905         <span class="keywordflow">return</span>;
00906     }
00907 
00908     <span class="keywordflow">if</span> (!(mode &amp; 1))
00909         <span class="keywordflow">goto</span> READTEST;
00910 
00912     <span class="comment">//                    WRITE TEST</span>
00914 <span class="comment"></span>    cout&lt;&lt;<span class="stringliteral">"\n\n"</span>;
00915     cout&lt;&lt;<span class="stringliteral">"==================================================\n"</span>;
00916     cout&lt;&lt;<span class="stringliteral">"             Write Rate Testing\n"</span>;
00917     cout&lt;&lt;<span class="stringliteral">"==================================================\n"</span>;
00918     cout&lt;&lt;<span class="stringliteral">"Continuous bursts of (100) 128 byte MWr TLPs\n"</span>;
00919     payloadSize = 128;
00920     numDWs = payloadSize / 4;
00921     nPkts = 100;   <span class="comment">// 12800 bytes of addressing</span>
00922     icg = 1;
00923     cycles = 1;  <span class="comment">// actually not used cause loop forever, but load with something sane</span>
00924 
00925 
00926     cout&lt;&lt;<span class="stringliteral">"Triggering RUN...looping...\n"</span>;
00927 
00928     pSFIF-&gt;setupSFIF(THRUPUT_MODE,  <span class="comment">// runMode</span>
00929                      MWR_TLPS,        <span class="comment">// trafficMode</span>
00930                      cycles, 
00931                      icg, 
00932                      0,             <span class="comment">// rdTLPSize</span>
00933                      payloadSize,  <span class="comment">// wrTLPSize</span>
00934                      0,             <span class="comment">// numRdTLPs</span>
00935                      nPkts);   <span class="comment">// numWrTLPs</span>
00936 
00937 
00938     pSFIF-&gt;startSFIF(<span class="keyword">true</span>);  <span class="comment">// loop forever</span>
00939 
00940     Sleep(msecRunTime);
00941 
00942     pSFIF-&gt;stopSFIF();
00943 
00944 
00945     pSFIF-&gt;getCntrs(sfifCnts);
00946     <a class="code" href="_s_f_i_f__menu_8cpp.html#a10">showSFIFCounters</a>(sfifCnts);
00947 
00948 
00949     pauseRatio = (double)(sfifCnts.WrWaitTime) / (double)(sfifCnts.ElapsedTime);
00950     cout&lt;&lt;<span class="stringliteral">"Run-time waiting for MWr credits: "</span>&lt;&lt;(pauseRatio * 100.0)&lt;&lt;<span class="stringliteral">"%\n"</span>;
00951 
00952 
00953     <span class="keywordflow">if</span> ((sfifCnts.ElapsedTime == 0xffffffff) || (sfifCnts.TxTLPCnt == 0xffffffff))
00954     {
00955         cout&lt;&lt;<span class="stringliteral">"ERROR!  Counters saturated.  Can't compute thruput.\n"</span>;
00956     }
00957     <span class="keywordflow">else</span>
00958     {
00959         totalBytes = (uint64_t)payloadSize * (uint64_t)sfifCnts.TxTLPCnt;
00960         thruput = ((totalBytes) / (8E-9 * sfifCnts.ElapsedTime)) / 1E6;
00961 
00962         cout&lt;&lt;<span class="stringliteral">"Wrote: "</span>&lt;&lt;(totalBytes)&lt;&lt;<span class="stringliteral">" bytes  in "</span>&lt;&lt;(8E-9 * sfifCnts.ElapsedTime)&lt;&lt;<span class="stringliteral">" secs   Throughput: "</span>&lt;&lt;thruput&lt;&lt;<span class="stringliteral">" MB/s\n"</span>;
00963     }
00964 
00965 
00966     READTEST:
00967     <span class="keywordflow">if</span> (!(mode &amp; 2))
00968         <span class="keywordflow">goto</span> READWRITE_TEST;
00969 
00971     <span class="comment">//                    READ TEST</span>
00973 <span class="comment"></span>    cout&lt;&lt;<span class="stringliteral">"\n\n"</span>;
00974     cout&lt;&lt;<span class="stringliteral">"==================================================\n"</span>;
00975     cout&lt;&lt;<span class="stringliteral">"             Read Rate Testing\n"</span>;
00976     cout&lt;&lt;<span class="stringliteral">"==================================================\n"</span>;
00977     cout&lt;&lt;<span class="stringliteral">"Continuous burst of 32 Read Requests of 512 bytes\n"</span>;
00978     readReqSize = 512;
00979     nPkts = 32;  <span class="comment">// need to limit so that we keep reads requests within the system DMA buffer</span>
00980     icg = 1;   <span class="comment">// we could set this to some value to simulate processing time for returned pkts</span>
00981                <span class="comment">// or just blast it and hope flow control keeps everything in check</span>
00982     cycles = 1;  <span class="comment">// actually not used cause loop forever, but load with something sane</span>
00983 
00984     cout&lt;&lt;<span class="stringliteral">"Triggering RUN...looping...\n"</span>;
00985 
00986     pSFIF-&gt;setupSFIF(THRUPUT_MODE,    <span class="comment">// runMode</span>
00987                      MRD_TLPS,        <span class="comment">// trafficMode</span>
00988                      cycles, 
00989                      icg, 
00990                      readReqSize,     <span class="comment">// rdTLPSize</span>
00991                      0,               <span class="comment">// wrTLPSize</span>
00992                      nPkts,           <span class="comment">// numRdTLPs</span>
00993                      0);              <span class="comment">// numWrTLPs</span>
00994 
00995 
00996     pSFIF-&gt;startSFIF(<span class="keyword">true</span>);  <span class="comment">// loop forever</span>
00997 
00998     Sleep(msecRunTime);
00999 
01000     pSFIF-&gt;stopSFIF();
01001 
01002 
01003     pSFIF-&gt;getCntrs(sfifCnts);
01004     <a class="code" href="_s_f_i_f__menu_8cpp.html#a10">showSFIFCounters</a>(sfifCnts);
01005 
01006 
01007     pauseRatio = (double)(sfifCnts.RdWaitTime) / (double)(sfifCnts.LastCplDTime);
01008     cout&lt;&lt;<span class="stringliteral">"Run-time waiting for MRd credits: "</span>&lt;&lt;(pauseRatio * 100.0)&lt;&lt;<span class="stringliteral">"%\n"</span>;
01009 
01010 
01011     <span class="keywordflow">if</span> ((sfifCnts.ElapsedTime == 0xffffffff) || (sfifCnts.RxTLPCnt == 0xffffffff) || (sfifCnts.LastCplDTime == 0xffffffff))
01012     {
01013         cout&lt;&lt;<span class="stringliteral">"ERROR!  Counters saturated.  Can't compute thruput.\n"</span>;
01014     }
01015     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (sfifCnts.LastCplDTime == 0xffffffff)
01016     {
01017         cout&lt;&lt;<span class="stringliteral">"ERROR!  No timestamp for CplDs!  Can't compute thruput.\n"</span>;
01018     }
01019     <span class="keywordflow">else</span>
01020     {
01021         <span class="comment">// assume all CplD have come in and ReadReqSize = 8 * RCB</span>
01022         totalBytes = (uint64_t)RCB * (uint64_t)sfifCnts.RxTLPCnt;
01023         thruput = ((totalBytes) / (8E-9 * sfifCnts.LastCplDTime)) / 1E6;
01024 
01025         cout&lt;&lt;<span class="stringliteral">"Recvd: "</span>&lt;&lt;totalBytes&lt;&lt;<span class="stringliteral">" bytes  in "</span>&lt;&lt;(8E-9 * sfifCnts.LastCplDTime)&lt;&lt;<span class="stringliteral">" secs   Throughput: "</span>&lt;&lt;thruput&lt;&lt;<span class="stringliteral">" MB/s\n"</span>;
01026     }
01027 
01028 
01029     READWRITE_TEST:
01030 
01031     <span class="keywordflow">if</span> (!(mode &amp; 4))
01032         <span class="keywordflow">goto</span> READWRITEACCESS_TEST;
01033 
01034 
01036     <span class="comment">//                  READ/WRITE TEST</span>
01038 <span class="comment"></span>    cout&lt;&lt;<span class="stringliteral">"\n\n"</span>;
01039     cout&lt;&lt;<span class="stringliteral">"==================================================\n"</span>;
01040     cout&lt;&lt;<span class="stringliteral">"             Read+Write Rate Testing\n"</span>;
01041     cout&lt;&lt;<span class="stringliteral">"==================================================\n"</span>;
01042     cout&lt;&lt;<span class="stringliteral">"Read Request Size: 512 bytes\n"</span>;
01043     readReqSize = 512;
01044     rdNumDWs = readReqSize / 4;
01045     cout&lt;&lt;<span class="stringliteral">"Write TLPs Size: 128 bytes\n"</span>;
01046     payloadSize = 128;
01047     wrNumDWs = payloadSize / 4;
01048 
01049     cout&lt;&lt;<span class="stringliteral">"nPkts (1-96): "</span>;
01050     cin&gt;&gt;nPkts;
01051     cout&lt;&lt;<span class="stringliteral">"MRd ratio (1/n): "</span>;
01052     cin&gt;&gt;pktRdRatio;
01053     cout&lt;&lt;<span class="stringliteral">"MWr ratio (1/n): "</span>;
01054     cin&gt;&gt;pktWrRatio;
01055     cout&lt;&lt;<span class="stringliteral">"ICG: "</span>;
01056     cin&gt;&gt;icg;
01057     cout&lt;&lt;<span class="stringliteral">"Cycles: "</span>;
01058     cin&gt;&gt;cycles;
01059 
01060     <span class="keywordflow">if</span> (pktRdRatio == 0)
01061         pktRdRatio = 1;
01062     <span class="keywordflow">if</span> (pktWrRatio == 0)
01063         pktWrRatio = 1;
01064 
01065     cout&lt;&lt;<span class="stringliteral">"Load MRd &amp; MWr TLPs into TX_FIFO\n"</span>;
01066     <span class="keywordflow">if</span> (cycles == 0)
01067     {
01068         pSFIF-&gt;setupSFIF(THRUPUT_MODE,    <span class="comment">// runMode</span>
01069                          MRD_MWR_TLPS,        <span class="comment">// trafficMode </span>
01070                          cycles, 
01071                          icg, 
01072                          readReqSize,     <span class="comment">// rdTLPSize</span>
01073                          payloadSize,               <span class="comment">// wrTLPSize</span>
01074                          nPkts,           <span class="comment">// numRdTLPs</span>
01075                          nPkts,             <span class="comment">// numWrTLPs</span>
01076                          pktRdRatio,
01077                          pktWrRatio);
01078         pSFIF-&gt;startSFIF(<span class="keyword">true</span>);  <span class="comment">// loop forever</span>
01079     }
01080     <span class="keywordflow">else</span>
01081     {
01082         pSFIF-&gt;setupSFIF(WRITE_CYC_MODE,    <span class="comment">// runMode</span>
01083                          MRD_MWR_TLPS,        <span class="comment">// trafficMode</span>
01084                          cycles, 
01085                          icg, 
01086                          readReqSize,     <span class="comment">// rdTLPSize</span>
01087                          payloadSize,               <span class="comment">// wrTLPSize</span>
01088                          nPkts,           <span class="comment">// numRdTLPs</span>
01089                          nPkts,             <span class="comment">// numWrTLPs</span>
01090                          pktRdRatio,
01091                          pktWrRatio);
01092         pSFIF-&gt;startSFIF(<span class="keyword">false</span>);  <span class="comment">// run cycles</span>
01093 
01094     }
01095 
01096     Sleep(msecRunTime);
01097 
01098     pSFIF-&gt;stopSFIF();
01099 
01100 
01101     pSFIF-&gt;getCntrs(sfifCnts);
01102     <a class="code" href="_s_f_i_f__menu_8cpp.html#a10">showSFIFCounters</a>(sfifCnts);
01103 
01104 
01105 
01106 
01107     <span class="keywordflow">if</span> (cycles == 0)
01108     {
01109 
01110         <span class="keywordflow">if</span> ((sfifCnts.ElapsedTime == 0xffffffff) || (sfifCnts.TxTLPCnt == 0xffffffff) || (sfifCnts.RxTLPCnt == 0xffffffff))
01111         {
01112             cout&lt;&lt;<span class="stringliteral">"ERROR!  Counters saturated.  Can't compute thruput.\n"</span>;
01113         }
01114         <span class="keywordflow">else</span>
01115         {
01116             pauseRatio = (double)(sfifCnts.WrWaitTime) / (double)(sfifCnts.ElapsedTime);
01117             cout&lt;&lt;<span class="stringliteral">"Run-time waiting for MWr credits: "</span>&lt;&lt;(pauseRatio * 100.0)&lt;&lt;<span class="stringliteral">"%\n"</span>;
01118 
01119             pauseRatio = (double)(sfifCnts.RdWaitTime) / (double)(sfifCnts.LastCplDTime);
01120             cout&lt;&lt;<span class="stringliteral">"Run-time waiting for MRd credits: "</span>&lt;&lt;(pauseRatio * 100.0)&lt;&lt;<span class="stringliteral">"%\n"</span>;
01121 
01122             cout&lt;&lt;<span class="stringliteral">"READ Thruput: "</span>;
01123             <span class="comment">// assume all CplD have come in and ReadReqSize = 8 * RCB </span>
01124             totalBytes = (uint64_t)RCB * (uint64_t)sfifCnts.RxTLPCnt;
01125             thruput = ((totalBytes) / (8E-9 * sfifCnts.LastCplDTime)) / 1E6;
01126 
01127             cout&lt;&lt;<span class="stringliteral">"\n   Recvd: "</span>&lt;&lt;totalBytes&lt;&lt;<span class="stringliteral">" bytes  in "</span>&lt;&lt;(8E-9 * sfifCnts.LastCplDTime)&lt;&lt;<span class="stringliteral">" secs   Throughput: "</span>&lt;&lt;thruput&lt;&lt;<span class="stringliteral">" MB/s\n"</span>;
01128 
01129             <span class="comment">// Factor in the number of MRd TLPs sent and remove this from the total Tx TLP count</span>
01130             cout&lt;&lt;<span class="stringliteral">"WRITE Thruput: "</span>;
01131             totalBytes = (uint64_t)payloadSize * ((uint64_t)sfifCnts.TxTLPCnt * pktRdRatio / (pktRdRatio + pktWrRatio));
01132             thruput = ((totalBytes) / (8E-9 * sfifCnts.ElapsedTime)) / 1E6;
01133 
01134             cout&lt;&lt;<span class="stringliteral">"\n   Wrote: "</span>&lt;&lt;totalBytes&lt;&lt;<span class="stringliteral">" bytes  in "</span>&lt;&lt;(8E-9 * sfifCnts.ElapsedTime)&lt;&lt;<span class="stringliteral">" secs   Throughput: "</span>&lt;&lt;thruput&lt;&lt;<span class="stringliteral">" MB/s\n"</span>;
01135         }
01136     }
01137     <span class="keywordflow">else</span>
01138     {
01139         cout&lt;&lt;<span class="stringliteral">"\nSurvived the Rd+Wr test."</span>&lt;&lt;endl;
01140     }
01141 
01142 
01143     READWRITEACCESS_TEST:
01144     <span class="keywordflow">if</span> (!(mode &amp; 8))
01145         <span class="keywordflow">return</span>;
01146 
01148     <span class="comment">//                  READ/WRITE/ACCESS TEST</span>
01150 <span class="comment"></span>    cout&lt;&lt;<span class="stringliteral">"\n\n"</span>;
01151     cout&lt;&lt;<span class="stringliteral">"==================================================\n"</span>;
01152     cout&lt;&lt;<span class="stringliteral">"       Read+Write+GPIO Access Rate Testing\n"</span>;
01153     cout&lt;&lt;<span class="stringliteral">"==================================================\n"</span>;
01154     cout&lt;&lt;<span class="stringliteral">"Read Request Size: 512 bytes\n"</span>;
01155     readReqSize = 512;
01156     rdNumDWs = readReqSize / 4;
01157     cout&lt;&lt;<span class="stringliteral">"Write TLPs Size: 128 bytes\n"</span>;
01158     payloadSize = 128;
01159     wrNumDWs = payloadSize / 4;
01160     nPkts = 16;
01161     icg = 1;
01162     cycles = 1;  <span class="comment">// actually not used cause loop forever, but load with something sane</span>
01163     pktRdRatio = 4;
01164     pktWrRatio = 1;
01165 
01166     cout&lt;&lt;<span class="stringliteral">"Load MRd &amp; MWr TLPs into TX_FIFO\n"</span>;
01167     pSFIF-&gt;setupSFIF(THRUPUT_MODE,    <span class="comment">// runMode</span>
01168                      MRD_MWR_TLPS,    <span class="comment">// trafficMode - both reads and writes</span>
01169                      cycles, 
01170                      icg, 
01171                      readReqSize,     <span class="comment">// rdTLPSize</span>
01172                      payloadSize,     <span class="comment">// wrTLPSize</span>
01173                      nPkts,       <span class="comment">// numRdTLPs</span>
01174                      nPkts,           <span class="comment">// numWrTLPs</span>
01175                      pktRdRatio,
01176                      pktWrRatio);
01177 
01178     pSFIF-&gt;startSFIF(<span class="keyword">true</span>);  <span class="comment">// loop forever</span>
01179 
01180 
01181 
01182 
01183     i = msecRunTime / 10;   <span class="comment">// fudge factor to get it to run for N msec</span>
01184 
01185     <span class="keywordtype">int</span> led = 1;
01186     <span class="keywordtype">int</span> err = 0;
01187     <span class="keywordflow">while</span> (i)
01188     {
01189         <span class="comment">// do a burst of 1000 GPIO accesses to PCIe board</span>
01190         <span class="keywordflow">for</span> (uint32_t jj = 0; jj &lt; 100; jj++)
01191         {
01192             <span class="comment">// write Scratch Pad</span>
01193             pGPIO-&gt;setScratchPad(jj);
01194             <span class="comment">// Read GPIO ID register and verify</span>
01195             <span class="keywordflow">if</span> (pGPIO-&gt;getID() != 0x53030100)
01196                 ++err;
01197             <span class="comment">// read scratch pad and verify</span>
01198             <span class="keywordflow">if</span> (pGPIO-&gt;getScratchPad() != jj)
01199                 ++err;
01200         }
01201 
01202         <span class="keywordflow">if</span> ((i % 10) == 0)  <span class="comment">// every 100msec show some activity</span>
01203         {
01204             pGPIO-&gt;setLED16Display((uint16_t)led);
01205             led = (led&lt;&lt;1) &amp; 0xffff;
01206             <span class="keywordflow">if</span> (led == 0)
01207                 led = 1;
01208         }
01209 
01210         Sleep(1);
01211         --i;
01212     }
01213 
01214     pSFIF-&gt;stopSFIF();
01215 
01216 
01217     pSFIF-&gt;getCntrs(sfifCnts);
01218     <a class="code" href="_s_f_i_f__menu_8cpp.html#a10">showSFIFCounters</a>(sfifCnts);
01219 
01220 
01221     <span class="keywordflow">if</span> ((sfifCnts.ElapsedTime == 0xffffffff) || (sfifCnts.TxTLPCnt == 0xffffffff) || (sfifCnts.RxTLPCnt == 0xffffffff))
01222     {
01223         cout&lt;&lt;<span class="stringliteral">"ERROR!  Counters saturated.  Can't compute thruput.\n"</span>;
01224     }
01225     <span class="keywordflow">else</span>
01226     {
01227         pauseRatio = (double)(sfifCnts.WrWaitTime) / (double)(sfifCnts.ElapsedTime);
01228         cout&lt;&lt;<span class="stringliteral">"Run-time waiting for MWr credits: "</span>&lt;&lt;(pauseRatio * 100.0)&lt;&lt;<span class="stringliteral">"%\n"</span>;
01229 
01230         pauseRatio = (double)(sfifCnts.RdWaitTime) / (double)(sfifCnts.LastCplDTime);
01231         cout&lt;&lt;<span class="stringliteral">"Run-time waiting for MRd credits: "</span>&lt;&lt;(pauseRatio * 100.0)&lt;&lt;<span class="stringliteral">"%\n"</span>;
01232 
01233         cout&lt;&lt;<span class="stringliteral">"READ Thruput: "</span>;
01234         <span class="comment">// assume all CplD have come in and ReadReqSize = 8 * RCB </span>
01235         totalBytes = (uint64_t)RCB * (uint64_t)sfifCnts.RxTLPCnt;
01236         thruput = ((totalBytes) / (8E-9 * sfifCnts.LastCplDTime)) / 1E6;
01237 
01238         cout&lt;&lt;<span class="stringliteral">"\n   Recvd: "</span>&lt;&lt;totalBytes&lt;&lt;<span class="stringliteral">" bytes  in "</span>&lt;&lt;(8E-9 * sfifCnts.LastCplDTime)&lt;&lt;<span class="stringliteral">" secs   Throughput: "</span>&lt;&lt;thruput&lt;&lt;<span class="stringliteral">" MB/s\n"</span>;
01239 
01240         <span class="comment">// Factor in the number of MRd TLPs sent and remove this from the total Tx TLP count</span>
01241         cout&lt;&lt;<span class="stringliteral">"WRITE Thruput: "</span>;
01242         totalBytes = (uint64_t)payloadSize * ((uint64_t)sfifCnts.TxTLPCnt * pktRdRatio / (pktRdRatio + pktWrRatio));
01243         thruput = ((totalBytes) / (8E-9 * sfifCnts.ElapsedTime)) / 1E6;
01244 
01245         cout&lt;&lt;<span class="stringliteral">"\n   Wrote: "</span>&lt;&lt;totalBytes&lt;&lt;<span class="stringliteral">" bytes  in "</span>&lt;&lt;(8E-9 * sfifCnts.ElapsedTime)&lt;&lt;<span class="stringliteral">" secs   Throughput: "</span>&lt;&lt;thruput&lt;&lt;<span class="stringliteral">" MB/s\n"</span>;
01246     }
01247 
01248 }
01249 
01250 
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Wed Jul 16 12:05:29 2008 for Lattice PCIe Thruput Demo by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.3.9.1 </small></address>
</body>
</html>
