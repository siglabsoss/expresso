<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>Lattice lscpcie2 Device Driver : lscpcie2.c File Reference</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.9.1 -->
<div class="qindex"><a class="qindex" href="main.html">Main&nbsp;Page</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a></div>
<h1>lscpcie2.c File Reference</h1><code>#include &lt;linux/init.h&gt;</code><br>
<code>#include &lt;linux/module.h&gt;</code><br>
<code>#include &lt;linux/version.h&gt;</code><br>
<code>#include &lt;linux/kernel.h&gt;</code><br>
<code>#include &lt;linux/fs.h&gt;</code><br>
<code>#include &lt;linux/errno.h&gt;</code><br>
<code>#include &lt;linux/miscdevice.h&gt;</code><br>
<code>#include &lt;linux/major.h&gt;</code><br>
<code>#include &lt;linux/slab.h&gt;</code><br>
<code>#include &lt;linux/proc_fs.h&gt;</code><br>
<code>#include &lt;linux/stat.h&gt;</code><br>
<code>#include &lt;linux/tty.h&gt;</code><br>
<code>#include &lt;linux/selection.h&gt;</code><br>
<code>#include &lt;linux/kmod.h&gt;</code><br>
<code>#include &lt;linux/mm.h&gt;</code><br>
<code>#include &lt;linux/vmalloc.h&gt;</code><br>
<code>#include &lt;linux/pagemap.h&gt;</code><br>
<code>#include &lt;linux/pci.h&gt;</code><br>
<code>#include &lt;linux/mman.h&gt;</code><br>
<code>#include &lt;asm/uaccess.h&gt;</code><br>
<code>#include &lt;asm/io.h&gt;</code><br>
<code>#include &lt;asm/pgalloc.h&gt;</code><br>
<code>#include "<a class="el" href="_ioctl_8h-source.html">Ioctl.h</a>"</code><br>

<p>
<a href="lscpcie2_8c-source.html">Go to the source code of this file.</a><table border="0" cellpadding="0" cellspacing="0">
<tr><td></td></tr>
<tr><td colspan="2"><br><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="a0" doxytag="lscpcie2.c::USE_PROC"></a>
#define&nbsp;</td><td class="memItemRight" valign="bottom"><b>USE_PROC</b></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="a1" doxytag="lscpcie2.c::TRUE"></a>
#define&nbsp;</td><td class="memItemRight" valign="bottom"><b>TRUE</b>&nbsp;&nbsp;&nbsp;1</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="a2" doxytag="lscpcie2.c::FALSE"></a>
#define&nbsp;</td><td class="memItemRight" valign="bottom"><b>FALSE</b>&nbsp;&nbsp;&nbsp;0</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="a3" doxytag="lscpcie2.c::NUM_BARS"></a>
#define&nbsp;</td><td class="memItemRight" valign="bottom"><b>NUM_BARS</b>&nbsp;&nbsp;&nbsp;MAX_PCI_BARS</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="a4" doxytag="lscpcie2.c::NUM_BOARDS"></a>
#define&nbsp;</td><td class="memItemRight" valign="bottom"><b>NUM_BOARDS</b>&nbsp;&nbsp;&nbsp;4</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="a5" doxytag="lscpcie2.c::MAX_BOARDS"></a>
#define&nbsp;</td><td class="memItemRight" valign="bottom"><b>MAX_BOARDS</b>&nbsp;&nbsp;&nbsp;(NUM_BOARDS)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="a6" doxytag="lscpcie2.c::MINORS_PER_BOARD"></a>
#define&nbsp;</td><td class="memItemRight" valign="bottom"><b>MINORS_PER_BOARD</b>&nbsp;&nbsp;&nbsp;1</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="a7" doxytag="lscpcie2.c::MAX_MINORS"></a>
#define&nbsp;</td><td class="memItemRight" valign="bottom"><b>MAX_MINORS</b>&nbsp;&nbsp;&nbsp;(MAX_BOARDS * MINORS_PER_BOARD)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="a8" doxytag="lscpcie2.c::DMA_BUFFER_SIZE"></a>
#define&nbsp;</td><td class="memItemRight" valign="bottom"><b>DMA_BUFFER_SIZE</b>&nbsp;&nbsp;&nbsp;(64 * 1024)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="a9" doxytag="lscpcie2.c::SC_BOARD"></a>
#define&nbsp;</td><td class="memItemRight" valign="bottom"><b>SC_BOARD</b>&nbsp;&nbsp;&nbsp;1</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="a10" doxytag="lscpcie2.c::ECP2M_BOARD"></a>
#define&nbsp;</td><td class="memItemRight" valign="bottom"><b>ECP2M_BOARD</b>&nbsp;&nbsp;&nbsp;2</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="a11" doxytag="lscpcie2.c::BASIC_DEMO"></a>
#define&nbsp;</td><td class="memItemRight" valign="bottom"><b>BASIC_DEMO</b>&nbsp;&nbsp;&nbsp;1</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="a12" doxytag="lscpcie2.c::SFIF_DEMO"></a>
#define&nbsp;</td><td class="memItemRight" valign="bottom"><b>SFIF_DEMO</b>&nbsp;&nbsp;&nbsp;2</td></tr>

<tr><td colspan="2"><br><h2>Typedefs</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">typedef PCI_Dev_BAR&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lscpcie2_8c.html#a13">pci_dev_bar_t</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="a14" doxytag="lscpcie2.c::pcie_board_t"></a>
typedef PCIE_Board&nbsp;</td><td class="memItemRight" valign="bottom"><b>pcie_board_t</b></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">typedef LSCPCIe2&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lscpcie2_8c.html#a15">lscpcie2_t</a></td></tr>

<tr><td colspan="2"><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="a25" doxytag="lscpcie2.c::MODULE_AUTHOR"></a>
&nbsp;</td><td class="memItemRight" valign="bottom"><b>MODULE_AUTHOR</b> ("Lattice Semiconductor")</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="a26" doxytag="lscpcie2.c::MODULE_DESCRIPTION"></a>
&nbsp;</td><td class="memItemRight" valign="bottom"><b>MODULE_DESCRIPTION</b> ("Lattice PCIe Eval Board Device Driver")</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="a27" doxytag="lscpcie2.c::MODULE_LICENSE"></a>
&nbsp;</td><td class="memItemRight" valign="bottom"><b>MODULE_LICENSE</b> ("Dual BSD/GPL")</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="a28" doxytag="lscpcie2.c::MODULE_ALIAS"></a>
&nbsp;</td><td class="memItemRight" valign="bottom"><b>MODULE_ALIAS</b> ("lscpcie2")</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="a29" doxytag="lscpcie2.c::MODULE_DEVICE_TABLE"></a>
&nbsp;</td><td class="memItemRight" valign="bottom"><b>MODULE_DEVICE_TABLE</b> (pci, lscpcie2_pci_id_tbl)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lscpcie2_8c.html#a30">lscpcie2_read_procmem</a> (char *buf, char **start, off_t offset, int count, int *eof, void *data)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lscpcie2_8c.html#a32">lscpcie2_open</a> (struct inode *inode, struct file *filp)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lscpcie2_8c.html#a33">lscpcie2_release</a> (struct inode *inode, struct file *filp)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lscpcie2_8c.html#a34">lscpcie2_ioctl</a> (struct inode *inode, struct file *filp, unsigned int cmd, unsigned long arg)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lscpcie2_8c.html#a35">lscpcie2_mmap</a> (struct file *filp, struct vm_area_struct *vma)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">ssize_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lscpcie2_8c.html#a36">lscpcie2_read</a> (struct file *filp, char __user *userBuf, size_t len, loff_t *offp)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">ssize_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lscpcie2_8c.html#a37">lscpcie2_write</a> (struct file *filp, const char __user *userBuf, size_t len, loff_t *offp)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="a40" doxytag="lscpcie2.c::module_param"></a>
&nbsp;</td><td class="memItemRight" valign="bottom"><b>module_param</b> (debug, int, 0)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="a41" doxytag="lscpcie2.c::MODULE_PARM_DESC"></a>
&nbsp;</td><td class="memItemRight" valign="bottom"><b>MODULE_PARM_DESC</b> (debug,"lscpcie2 enable debugging (0-1)")</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="a44" doxytag="lscpcie2.c::module_init"></a>
&nbsp;</td><td class="memItemRight" valign="bottom"><b>module_init</b> (lscpcie2_init)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="a45" doxytag="lscpcie2.c::module_exit"></a>
&nbsp;</td><td class="memItemRight" valign="bottom"><b>module_exit</b> (lscpcie2_exit)</td></tr>

</table>
<hr><a name="_details"></a><h2>Detailed Description</h2>
Generic PCI/PCI-Express Device Driver for Lattice Eval Boards.<p>
NOTE: code has been targeted for RedHat WorkStation 4.0 update 4 kernel 2.6.9-42.ELsmp #1 SMP Wed Jul 12 23:27:17 EDT 2006 i686 i686 i386 GNU/Linux<p>
A Linux kernel device driver, for Lattice PCIe Eval boards on the PCIe bus, that maps the device's PCI address windows (its BAR0-n) into shared memory that is accessible by a user-space driver that implements the real control of the device.<p>
The intent is to map each active BAR to a corresponding minor device so that the user space driver can open that minor device and mmap it to get access to the registers.<p>
The BAR register definitions are Demo/application specific. The driver does not make any assumptions about the number of BARs that exist or their size or use. These are policies of the demo. The driver just makes them available to user space.<p>
The driver places no policies on the use of the device. It simply allows direct access to the PCI memory space occupied by the device. Any number of processes can open the device. It is up to the higher level application space driver to coordinate multiple accesses. The policy is basically the same as a flat memory space embedded system.<p>
The ioctl system call can be used to control interrupts or other global settings of the device.<p>
BUILDING:<p>
Compile as regular user (no need to be root) The product is a kernel module: lscpcie2.ko<p>
INSTALLING:<p>
Need to be root to install a module.<p>
Use the shell scripts insdrvr and rmdrvr to install and remove the driver. The scripts may perform udev operations to make the devices known to the /dev file system.<p>
Manual: install with system call: /sbin/insmod lscpice.ko remove with system call: /sbin/rmmod lscpcie2.ko check status of module: cat /proc/modules cat /proc/devices<p>
The printk() messages can be seen by running the command dmesg.<p>
The Major device number is dynamically assigned. This info can be found in /proc/devices.<p>
The minor number refers to the specific device. Previous incarnations used the minor number to encode the board and BAR to access. This has been abandoned, and the minor now referes to the specific device controlled by this driver (i.e. the eval board). Once open() the user has access to all BARs and board resources through the same file descriptor. The user space code knows how many BARs are active via ioctl calls to return the PCI resource info.<p>
Diagnostic information can be seen with: cat /proc/driver/lscpcie2<p>
The standard read/write system operations are not implemented because the user has direct access to the device registers via a standard pointer.<p>
This driver implements the 2.6 kernel method of sysfs and probing to register the driver, discover devices and make them available to user space programs. A major player is creating a specific Class lscpcie2 which<p>
register it with the PCI subsystem to probe for the eval board(s) register it as a character device (cdev) so it can get a major number and minor numbers create a special sysfs Class and add each discovered device under the class udev processes the /sys/class/ tree to populate<p>
BASED ON: Original lscpcie Linux driver which did things the 2.4 kernel way<p>
My previous work on vxp524 driver<p>
And: ------------------------------------------------------------------------ Host shared memory driver (Mark McLeland 3Com/Cal Poly Project) ------------------------------------------------------------------------ linux/drivers/char/mem.c (RedHat 2.4.7 kernel)<p>
Copyright (C) 1991, 1992 Linus Torvalds<p>
Added devfs support. Jan-11-1998, C. Scott Ananian &lt;<a href="mailto:cananian@alumni.princeton.edu">cananian@alumni.princeton.edu</a>&gt; Shared /dev/zero mmaping support, Feb 2000, Kanoj Sarcar &lt;<a href="mailto:kanoj@sgi.com">kanoj@sgi.com</a>&gt; -----------------------------------------------------------------------
<p>
Definition in file <a class="el" href="lscpcie2_8c-source.html">lscpcie2.c</a>.<hr><h2>Typedef Documentation</h2>
<a class="anchor" name="a15" doxytag="lscpcie2.c::lscpcie2_t"></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">typedef struct LSCPCIe2  <a class="el" href="lscpcie2_8c.html#a15">lscpcie2_t</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
The main container of all the data structures and elements that comprise the lscpcie2 device driver. Main elements are the array of detected eval boards, the sysfs class, the assigned driver number.     </td>
  </tr>
</table>
<a class="anchor" name="a13" doxytag="lscpcie2.c::pci_dev_bar_t"></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">typedef struct PCI_Dev_BAR  <a class="el" href="lscpcie2_8c.html#a13">pci_dev_bar_t</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
This is the private data for each board's BAR that is mapped in. NOTE: each structure MUST have minor as the first entry because it it tested by a void * to see what BAR it is - See mmap() 
<p>
Referenced by <a class="el" href="lscpcie2_8c-source.html#l00924">lscpcie2_mmap()</a>, and <a class="el" href="lscpcie2_8c-source.html#l00353">lscpcie2_read_procmem()</a>.    </td>
  </tr>
</table>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="a34" doxytag="lscpcie2.c::lscpcie2_ioctl"></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int lscpcie2_ioctl           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">struct inode *&nbsp;</td>
          <td class="mdname" nowrap> <em>inode</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>struct file *&nbsp;</td>
          <td class="mdname" nowrap> <em>filp</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>unsigned int&nbsp;</td>
          <td class="mdname" nowrap> <em>cmd</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>unsigned long&nbsp;</td>
          <td class="mdname" nowrap> <em>arg</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
ioctl. Allow simple access to generic PCI control type things like enabling device interrupts and such. IOCTL works on a board object as a whole, not a BAR. 
<p>
Definition at line <a class="el" href="lscpcie2_8c-source.html#l00781">781</a> of file <a class="el" href="lscpcie2_8c-source.html">lscpcie2.c</a>.
<p>
References <a class="el" href="_ioctl_8h-source.html#l00069">PCIResourceInfo_t::BAR</a>, <a class="el" href="_ioctl_8h-source.html#l00090">ExtraResourceInfo_t::busNum</a>, <a class="el" href="_ioctl_8h-source.html#l00091">ExtraResourceInfo_t::deviceNum</a>, <a class="el" href="_ioctl_8h-source.html#l00088">ExtraResourceInfo_t::devID</a>, <a class="el" href="_ioctl_8h-source.html#l00098">ExtraResourceInfo_t::DmaAddr64</a>, <a class="el" href="_ioctl_8h-source.html#l00097">ExtraResourceInfo_t::DmaBufSize</a>, <a class="el" href="_ioctl_8h-source.html#l00099">ExtraResourceInfo_t::DmaPhyAddrHi</a>, <a class="el" href="_ioctl_8h-source.html#l00100">ExtraResourceInfo_t::DmaPhyAddrLo</a>, <a class="el" href="_ioctl_8h-source.html#l00103">ExtraResourceInfo_t::DriverName</a>, <a class="el" href="_ioctl_8h-source.html#l00049">PCI_BAR_t::flags</a>, <a class="el" href="_ioctl_8h-source.html#l00092">ExtraResourceInfo_t::functionNum</a>, <a class="el" href="_ioctl_8h-source.html#l00096">ExtraResourceInfo_t::hasDmaBuf</a>, <a class="el" href="_ioctl_8h-source.html#l00074">PCIResourceInfo_t::hasInterrupt</a>, <a class="el" href="_ioctl_8h-source.html#l00075">PCIResourceInfo_t::intrVector</a>, <a class="el" href="_ioctl_8h-source.html#l00136">IOCTL_LSCPCIE2_GET_EXTRA_INFO</a>, <a class="el" href="_ioctl_8h-source.html#l00126">IOCTL_LSCPCIE_GET_RESOURCES</a>, <a class="el" href="_ioctl_8h-source.html#l00120">IOCTL_LSCPCIE_GET_VERSION_INFO</a>, <a class="el" href="_ioctl_8h-source.html#l00131">IOCTL_LSCPCIE_SET_BAR</a>, <a class="el" href="_ioctl_8h-source.html#l00048">PCI_BAR_t::memMapped</a>, <a class="el" href="_ioctl_8h-source.html#l00045">PCI_BAR_t::nBAR</a>, <a class="el" href="_ioctl_8h-source.html#l00068">PCIResourceInfo_t::numBARs</a>, <a class="el" href="_ioctl_8h-source.html#l00071">PCIResourceInfo_t::PCICfgReg</a>, <a class="el" href="_ioctl_8h-source.html#l00046">PCI_BAR_t::physStartAddr</a>, <a class="el" href="_ioctl_8h-source.html#l00047">PCI_BAR_t::size</a>, <a class="el" href="_ioctl_8h-source.html#l00050">PCI_BAR_t::type</a>, and <a class="el" href="_ioctl_8h-source.html#l00093">ExtraResourceInfo_t::UINumber</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a35" doxytag="lscpcie2.c::lscpcie2_mmap"></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int lscpcie2_mmap           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">struct file *&nbsp;</td>
          <td class="mdname" nowrap> <em>filp</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>struct vm_area_struct *&nbsp;</td>
          <td class="mdname" nowrap> <em>vma</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
mmap. This is the most important driver method. This maps the device's PCI address space (based on the select mmap BAR number) into the user's address space, allowing direct memory access with standard pointers. 
<p>
Definition at line <a class="el" href="lscpcie2_8c-source.html#l00924">924</a> of file <a class="el" href="lscpcie2_8c-source.html">lscpcie2.c</a>.
<p>
References <a class="el" href="lscpcie2_8c.html#a13">pci_dev_bar_t</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a32" doxytag="lscpcie2.c::lscpcie2_open"></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int lscpcie2_open           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">struct inode *&nbsp;</td>
          <td class="mdname" nowrap> <em>inode</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>struct file *&nbsp;</td>
          <td class="mdname" nowrap> <em>filp</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Open Any number of devices can open this address space. The main reason for this method is so the user has a file descriptor to pass to mmap() to get the device memory mapped into their address space.<p>
The minor number is the index into the Board[] list. It specifies exactly what board and is correlated to the device node filename. Only valid board devices that have been enumerated by probe() and initialized are in the list, are in /sys/class/lscpcie2/ and should appear in /dev/lscpcie/<p>
Note that the PCI device has already been enabled in probe() and init so it doesn't need to be done again. 
<p>
Definition at line <a class="el" href="lscpcie2_8c-source.html#l00708">708</a> of file <a class="el" href="lscpcie2_8c-source.html">lscpcie2.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a36" doxytag="lscpcie2.c::lscpcie2_read"></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">ssize_t lscpcie2_read           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">struct file *&nbsp;</td>
          <td class="mdname" nowrap> <em>filp</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>char __user *&nbsp;</td>
          <td class="mdname" nowrap> <em>userBuf</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>size_t&nbsp;</td>
          <td class="mdname" nowrap> <em>len</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>loff_t *&nbsp;</td>
          <td class="mdname" nowrap> <em>offp</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
read. Read from system CommonBuffer DMA memory into users buffer. User passes length (in bytes) like reading from a file. 
<p>
Definition at line <a class="el" href="lscpcie2_8c-source.html#l01002">1002</a> of file <a class="el" href="lscpcie2_8c-source.html">lscpcie2.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a30" doxytag="lscpcie2.c::lscpcie2_read_procmem"></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int lscpcie2_read_procmem           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">char *&nbsp;</td>
          <td class="mdname" nowrap> <em>buf</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>char **&nbsp;</td>
          <td class="mdname" nowrap> <em>start</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>off_t&nbsp;</td>
          <td class="mdname" nowrap> <em>offset</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>count</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>int *&nbsp;</td>
          <td class="mdname" nowrap> <em>eof</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>void *&nbsp;</td>
          <td class="mdname" nowrap> <em>data</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Procedure to format and display data into the /proc filesystem when a user cats the /proc/driver/lscpie2 file. Displays the driver major/minor #'s, BARs that are allocated, interrupt resources. General infomation about the board that was initialized. 
<p>
Definition at line <a class="el" href="lscpcie2_8c-source.html#l00353">353</a> of file <a class="el" href="lscpcie2_8c-source.html">lscpcie2.c</a>.
<p>
References <a class="el" href="lscpcie2_8c.html#a13">pci_dev_bar_t</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a33" doxytag="lscpcie2.c::lscpcie2_release"></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int lscpcie2_release           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">struct inode *&nbsp;</td>
          <td class="mdname" nowrap> <em>inode</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>struct file *&nbsp;</td>
          <td class="mdname" nowrap> <em>filp</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Close. The complement to open(). 
<p>
Definition at line <a class="el" href="lscpcie2_8c-source.html#l00752">752</a> of file <a class="el" href="lscpcie2_8c-source.html">lscpcie2.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a37" doxytag="lscpcie2.c::lscpcie2_write"></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">ssize_t lscpcie2_write           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">struct file *&nbsp;</td>
          <td class="mdname" nowrap> <em>filp</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>const char __user *&nbsp;</td>
          <td class="mdname" nowrap> <em>userBuf</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>size_t&nbsp;</td>
          <td class="mdname" nowrap> <em>len</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>loff_t *&nbsp;</td>
          <td class="mdname" nowrap> <em>offp</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
write. Write from users buffer into system CommonBuffer DMA memory. User passes length (in bytes) like writing to a file. 
<p>
Definition at line <a class="el" href="lscpcie2_8c-source.html#l01030">1030</a> of file <a class="el" href="lscpcie2_8c-source.html">lscpcie2.c</a>.    </td>
  </tr>
</table>
<hr size="1"><address style="align: right;"><small>Generated on Wed Jul 16 12:05:23 2008 for Lattice lscpcie2 Device Driver  by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.3.9.1 </small></address>
</body>
</html>
